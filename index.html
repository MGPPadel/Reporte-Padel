<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Informe de Clases de Padel</title>

    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, collection, addDoc, getDoc, getDocs, updateDoc, deleteDoc, query, where, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "",
            authDomain: "",
            projectId: "",
            storageBucket: "",
            messagingSenderId: "",
            appId: ""
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const { useState, useEffect } = React;

        const App = () => {
            const [user, setUser] = useState(null);
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState(null);
            const [isLoginMode, setIsLoginMode] = useState(true);
            const [activeTab, setActiveTab] = useState('clases');
            const [classes, setClasses] = useState([]);
            const [students, setStudents] = useState([]);
            const [editingClassId, setEditingClassId] = useState(null);
            const [editingStudentId, setEditingStudentId] = useState(null);
            const [newEntry, setNewEntry] = useState({
                date: '',
                time: '',
                location: '',
                duration: '',
                studentNames: [''],
                cost: '',
                isPaid: false
            });
            const [newStudent, setNewStudent] = useState({
                firstName: '',
                lastName: '',
                phoneNumber: '',
                notes: ''
            });
            const [totalClasses, setTotalClasses] = useState(0);
            const [totalStudents, setTotalStudents] = useState(0);
            const [selectedMonth, setSelectedMonth] = useState('');
            const [showLoginModal, setShowLoginModal] = useState(false);
            const [userId, setUserId] = useState(null);
            const [userActivity, setUserActivity] = useState([]);

            useEffect(() => {
                const unsubscribe = onAuthStateChanged(auth, (currentUser) => {
                    setUser(currentUser);
                    if (currentUser) {
                        setUserId(currentUser.uid);
                        // Cargar datos del usuario
                        fetchData(currentUser.uid);
                        fetchStudents(currentUser.uid);
                        fetchActivity(currentUser.uid);
                    } else {
                        // Limpiar estados si el usuario cierra sesión
                        setClasses([]);
                        setStudents([]);
                        setUserActivity([]);
                        setUserId(null);
                        setTotalClasses(0);
                        setTotalStudents(0);
                    }
                });
                return () => unsubscribe();
            }, []);

            useEffect(() => {
                if (user) {
                    const classesRef = collection(db, `users/${user.uid}/classes`);
                    const q = selectedMonth
                        ? query(classesRef, where('date', '>=', `${selectedMonth}-01`), where('date', '<=', `${selectedMonth}-31`))
                        : classesRef;

                    const unsubscribe = onSnapshot(q, (snapshot) => {
                        const classesData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        setClasses(classesData);
                        setTotalClasses(classesData.length);
                    });

                    return () => unsubscribe();
                }
            }, [user, selectedMonth]);

            const fetchData = async (uid) => {
                try {
                    const classesCollectionRef = collection(db, `users/${uid}/classes`);
                    const classesSnapshot = await getDocs(classesCollectionRef);
                    const classesData = classesSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    setClasses(classesData);
                    setTotalClasses(classesData.length);
                } catch (e) {
                    console.error("Error fetching documents: ", e);
                    setError("Error al cargar los datos.");
                }
            };

            const fetchStudents = async (uid) => {
                try {
                    const studentsCollectionRef = collection(db, `users/${uid}/students`);
                    const studentsSnapshot = await getDocs(studentsCollectionRef);
                    const studentsData = studentsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    setStudents(studentsData);
                    setTotalStudents(studentsData.length);
                } catch (e) {
                    console.error("Error fetching students: ", e);
                }
            };

            const fetchActivity = async (uid) => {
                try {
                    const activityRef = collection(db, `users/${uid}/activity_log`);
                    const q = query(activityRef, (query) => query.orderBy('timestamp', 'desc').limit(10));
                    const querySnapshot = await getDocs(q);
                    const activityData = querySnapshot.docs.map(doc => doc.data());
                    setUserActivity(activityData);
                } catch (e) {
                    console.error("Error fetching activity log: ", e);
                }
            };

            const addActivityLog = async (action, details) => {
                if (!user) return;
                const activityRef = collection(db, `users/${user.uid}/activity_log`);
                await addDoc(activityRef, {
                    action,
                    details,
                    timestamp: new Date().toISOString()
                });
            };

            const handleAuth = async (e) => {
                e.preventDefault();
                setError(null);
                try {
                    if (isLoginMode) {
                        await signInWithEmailAndPassword(auth, email, password);
                        addActivityLog('Inicio de Sesión', `Usuario ${email} ha iniciado sesión.`);
                    } else {
                        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                        const userId = userCredential.user.uid;
                        // Opcional: crea una colección inicial para el usuario
                        await addDoc(collection(db, `users/${userId}/classes`), {
                            date: '2023-01-01',
                            time: '12:00',
                            location: 'Cancha 1',
                            duration: '1h',
                            studentNames: ['Pepe Perez'],
                            cost: '10',
                            isPaid: true
                        });
                        addActivityLog('Registro', `Nuevo usuario ${email} registrado.`);
                    }
                } catch (e) {
                    const errorCode = e.code;
                    let errorMessage = "Ocurrió un error. Por favor, inténtalo de nuevo.";
                    if (errorCode === 'auth/invalid-email') {
                        errorMessage = "El email no es válido.";
                    } else if (errorCode === 'auth/user-not-found') {
                        errorMessage = "No se encontró un usuario con este email.";
                    } else if (errorCode === 'auth/wrong-password') {
                        errorMessage = "La contraseña es incorrecta.";
                    } else if (errorCode === 'auth/email-already-in-use') {
                        errorMessage = "Este email ya está en uso.";
                    } else if (errorCode === 'auth/weak-password') {
                        errorMessage = "La contraseña debe tener al menos 6 caracteres.";
                    }
                    setError(errorMessage);
                }
            };

            const signOutUser = async () => {
                if (user) {
                    addActivityLog('Cierre de Sesión', `Usuario ${user.email} ha cerrado sesión.`);
                }
                await signOut(auth);
            };

            const handleNewEntryChange = (e) => {
                const { name, value } = e.target;
                if (name.startsWith('studentName')) {
                    const index = parseInt(name.split('-')[1]);
                    const newStudentNames = [...newEntry.studentNames];
                    newStudentNames[index] = value;
                    setNewEntry({ ...newEntry, studentNames: newStudentNames });
                } else if (name === 'isPaid') {
                    setNewEntry({ ...newEntry, [name]: e.target.checked });
                } else {
                    setNewEntry({ ...newEntry, [name]: value });
                }
            };

            const handleStudentChange = (e) => {
                const { name, value } = e.target;
                setNewStudent({ ...newStudent, [name]: value });
            };

            const addClass = async (e) => {
                e.preventDefault();
                if (!user) {
                    setError("Debes iniciar sesión para añadir una clase.");
                    return;
                }

                if (newEntry.studentNames.some(name => name.trim() === '') || newEntry.date === '' || newEntry.location === '' || newEntry.cost === '') {
                    setError("Por favor, completa todos los campos requeridos (Fecha, Lugar, Costo y Nombres de Alumnos).");
                    return;
                }

                try {
                    await addDoc(collection(db, `users/${user.uid}/classes`), newEntry);
                    addActivityLog('Clase Agregada', `Clase en ${newEntry.location} el ${newEntry.date} con ${newEntry.studentNames.join(', ')}.`);
                    setNewEntry({
                        date: '',
                        time: '',
                        location: '',
                        duration: '',
                        studentNames: [''],
                        cost: '',
                        isPaid: false
                    });
                    setError(null);
                    setActiveTab('clases'); // Redirige a la pestaña de clases
                } catch (e) {
                    console.error("Error adding document: ", e);
                    setError("Error al añadir la clase.");
                }
            };

            const editClass = async (e) => {
                e.preventDefault();
                if (!user || !editingClassId) return;

                if (newEntry.studentNames.some(name => name.trim() === '') || newEntry.date === '' || newEntry.location === '' || newEntry.cost === '') {
                    setError("Por favor, completa todos los campos requeridos (Fecha, Lugar, Costo y Nombres de Alumnos).");
                    return;
                }

                try {
                    const classRef = doc(db, `users/${user.uid}/classes`, editingClassId);
                    await updateDoc(classRef, newEntry);
                    addActivityLog('Clase Editada', `Clase del ${newEntry.date} ha sido editada.`);
                    setEditingClassId(null);
                    setNewEntry({
                        date: '',
                        time: '',
                        location: '',
                        duration: '',
                        studentNames: [''],
                        cost: '',
                        isPaid: false
                    });
                    setError(null);
                } catch (e) {
                    console.error("Error updating document: ", e);
                    setError("Error al actualizar la clase.");
                }
            };

            const startEditingClass = (classData) => {
                setEditingClassId(classData.id);
                setNewEntry({ ...classData });
                setActiveTab('añadir-clase');
            };

            const deleteClass = async (id, date) => {
                if (!user) return;
                if (window.confirm(`¿Estás seguro de que quieres eliminar la clase del ${date}?`)) {
                    try {
                        const classRef = doc(db, `users/${user.uid}/classes`, id);
                        await deleteDoc(classRef);
                        addActivityLog('Clase Eliminada', `Clase del ${date} ha sido eliminada.`);
                        // La actualización se maneja con el onSnapshot
                    } catch (e) {
                        console.error("Error deleting document: ", e);
                        setError("Error al eliminar la clase.");
                    }
                }
            };

            const addStudent = async (e) => {
                e.preventDefault();
                if (!user) {
                    setError("Debes iniciar sesión para añadir un alumno.");
                    return;
                }

                if (newStudent.firstName.trim() === '' || newStudent.lastName.trim() === '') {
                    setError("Por favor, completa al menos el nombre y apellido del alumno.");
                    return;
                }

                try {
                    await addDoc(collection(db, `users/${user.uid}/students`), newStudent);
                    addActivityLog('Alumno Agregado', `Nuevo alumno ${newStudent.firstName} ${newStudent.lastName} agregado.`);
                    setNewStudent({ firstName: '', lastName: '', phoneNumber: '', notes: '' });
                    setError(null);
                    fetchStudents(user.uid);
                    setActiveTab('alumnos');
                } catch (e) {
                    console.error("Error adding student: ", e);
                    setError("Error al añadir el alumno.");
                }
            };

            const editStudent = async (e) => {
                e.preventDefault();
                if (!user || !editingStudentId) return;

                if (newStudent.firstName.trim() === '' || newStudent.lastName.trim() === '') {
                    setError("Por favor, completa al menos el nombre y apellido del alumno.");
                    return;
                }

                try {
                    const studentRef = doc(db, `users/${user.uid}/students`, editingStudentId);
                    await updateDoc(studentRef, newStudent);
                    addActivityLog('Alumno Editado', `Alumno ${newStudent.firstName} ${newStudent.lastName} editado.`);
                    setEditingStudentId(null);
                    setNewStudent({ firstName: '', lastName: '', phoneNumber: '', notes: '' });
                    setError(null);
                    fetchStudents(user.uid);
                } catch (e) {
                    console.error("Error updating student: ", e);
                    setError("Error al actualizar el alumno.");
                }
            };

            const startEditingStudent = (studentData) => {
                setEditingStudentId(studentData.id);
                setNewStudent({ ...studentData });
                setActiveTab('añadir-alumno');
            };

            const deleteStudent = async (id, name) => {
                if (!user) return;
                if (window.confirm(`¿Estás seguro de que quieres eliminar a ${name}?`)) {
                    try {
                        const studentRef = doc(db, `users/${user.uid}/students`, id);
                        await deleteDoc(studentRef);
                        addActivityLog('Alumno Eliminado', `Alumno ${name} ha sido eliminado.`);
                        fetchStudents(user.uid);
                    } catch (e) {
                        console.error("Error deleting student: ", e);
                        setError("Error al eliminar el alumno.");
                    }
                }
            };

            const handleMonthChange = (e) => {
                setSelectedMonth(e.target.value);
            };

            const generateReport = async () => {
                // Seleccionar solo la sección de clases para el informe
                const element = document.getElementById('report-section');
                const classesForReport = classes.filter(c => {
                    if (!selectedMonth) return true;
                    return c.date.startsWith(selectedMonth);
                });

                if (classesForReport.length === 0) {
                    alert('No hay clases para el mes seleccionado.');
                    return;
                }

                const income = classesForReport.reduce((sum, c) => sum + parseFloat(c.cost || 0), 0);
                const paidIncome = classesForReport.filter(c => c.isPaid).reduce((sum, c) => sum + parseFloat(c.cost || 0), 0);
                const unpaidIncome = classesForReport.filter(c => !c.isPaid).reduce((sum, c) => sum + parseFloat(c.cost || 0), 0);

                const reportContent = `
                    <style>
                        body { font-family: sans-serif; }
                        h1 { color: #1e3a8a; text-align: center; }
                        .summary { display: flex; justify-content: space-around; margin-bottom: 20px; }
                        .summary-item { text-align: center; padding: 10px; border-radius: 8px; background-color: #f3f4f6; }
                        .list { width: 100%; border-collapse: collapse; margin-top: 20px; }
                        .list th, .list td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        .list th { background-color: #d1d5db; }
                    </style>
                    <h1>Informe de Clases de Padel ${selectedMonth || ''}</h1>
                    <div class="summary">
                        <div class="summary-item">
                            <h3>Clases</h3>
                            <p>${classesForReport.length}</p>
                        </div>
                        <div class="summary-item">
                            <h3>Ingresos Totales</h3>
                            <p>$${income.toFixed(2)}</p>
                        </div>
                        <div class="summary-item">
                            <h3>Ingresos Cobrados</h3>
                            <p>$${paidIncome.toFixed(2)}</p>
                        </div>
                        <div class="summary-item">
                            <h3>Ingresos Pendientes</h3>
                            <p>$${unpaidIncome.toFixed(2)}</p>
                        </div>
                    </div>
                    <table class="list">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Hora</th>
                                <th>Lugar</th>
                                <th>Alumnos</th>
                                <th>Costo</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${classesForReport.map(c => `
                                <tr>
                                    <td>${c.date}</td>
                                    <td>${c.time}</td>
                                    <td>${c.location}</td>
                                    <td>${c.studentNames.join(', ')}</td>
                                    <td>$${c.cost}</td>
                                    <td>${c.isPaid ? 'Pagado' : 'Pendiente'}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;

                // Crear un nuevo documento HTML para el PDF
                const newWindow = window.open('', '_blank');
                newWindow.document.write(reportContent);
                newWindow.document.close();

                // Esperar a que el contenido se cargue y luego generar el PDF
                newWindow.onload = () => {
                    const doc = new jspdf.jsPDF();
                    doc.html(newWindow.document.body, {
                        callback: function (doc) {
                            doc.save(`Informe_Padel_${selectedMonth}.pdf`);
                            newWindow.close();
                            addActivityLog('Reporte Generado', `Reporte de clases para ${selectedMonth} ha sido generado.`);
                        },
                        x: 10,
                        y: 10,
                        html2canvas: { scale: 0.5 }
                    });
                };
            };


            const formatDate = (isoString) => {
                const date = new Date(isoString);
                return `${date.toLocaleDateString()} ${date.toLocaleTimeString()}`;
            };


            return (
                <div className="min-h-screen bg-gray-100 p-4">
                    <div className="max-w-4xl mx-auto bg-white shadow-xl rounded-lg overflow-hidden">
                        {!user ? (
                            <div className="p-8">
                                <h2 className="text-2xl font-bold text-center text-gray-800 mb-4">{isLoginMode ? 'Iniciar Sesión' : 'Registrarse'}</h2>
                                <form onSubmit={handleAuth} className="space-y-4">
                                    {error && <div className="text-red-500 text-center">{error}</div>}
                                    <div>
                                        <label className="block text-gray-700 font-medium">Email</label>
                                        <input
                                            type="email"
                                            value={email}
                                            onChange={(e) => setEmail(e.target.value)}
                                            className="mt-1 p-2 w-full border rounded-lg focus:ring-2 focus:ring-blue-500 transition-shadow"
                                            required
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-gray-700 font-medium">Contraseña</label>
                                        <input
                                            type="password"
                                            value={password}
                                            onChange={(e) => setPassword(e.target.value)}
                                            className="mt-1 p-2 w-full border rounded-lg focus:ring-2 focus:ring-blue-500 transition-shadow"
                                            required
                                        />
                                    </div>
                                    <button type="submit" className="w-full bg-blue-600 text-white font-bold p-3 rounded-lg hover:bg-blue-700 transition-colors">
                                        {isLoginMode ? 'Iniciar Sesión' : 'Registrarse'}
                                    </button>
                                </form>
                                <p className="mt-4 text-center">
                                    {isLoginMode ? '¿No tienes una cuenta?' : '¿Ya tienes una cuenta?'}
                                    <button
                                        onClick={() => setIsLoginMode(!isLoginMode)}
                                        className="text-blue-600 font-bold ml-1 hover:underline"
                                    >
                                        {isLoginMode ? 'Regístrate aquí' : 'Inicia sesión aquí'}
                                    </button>
                                </p>
                            </div>
                        ) : (
                            <>
                                <div className="p-4 bg-gray-200 flex justify-between items-center flex-wrap">
                                    <div className="flex items-center space-x-4 mb-2 md:mb-0">
                                        <i className="fa-solid fa-user-circle text-gray-700 text-2xl"></i>
                                        <span className="text-gray-800 font-medium text-lg hidden sm:block">{user.email}</span>
                                    </div>
                                    <h1 className="text-3xl font-bold text-center text-blue-800 w-full md:w-auto">Padel Tracker</h1>
                                    <button onClick={signOutUser} className="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors self-end">
                                        Cerrar Sesión
                                    </button>
                                </div>

                                <div className="bg-white p-4">
                                    <div className="flex justify-around border-b border-gray-300 mb-4">
                                        <button
                                            onClick={() => setActiveTab('clases')}
                                            className={`py-2 px-4 font-bold ${activeTab === 'clases' ? 'text-blue-600 border-b-2 border-blue-600' : 'text-gray-600'}`}
                                        >
                                            <i className="fa-solid fa-calendar-check mr-1"></i> Clases
                                        </button>
                                        <button
                                            onClick={() => setActiveTab('añadir-clase')}
                                            className={`py-2 px-4 font-bold ${activeTab === 'añadir-clase' ? 'text-blue-600 border-b-2 border-blue-600' : 'text-gray-600'}`}
                                        >
                                            <i className="fa-solid fa-plus-circle mr-1"></i> Añadir Clase
                                        </button>
                                        <button
                                            onClick={() => setActiveTab('alumnos')}
                                            className={`py-2 px-4 font-bold ${activeTab === 'alumnos' ? 'text-blue-600 border-b-2 border-blue-600' : 'text-gray-600'}`}
                                        >
                                            <i className="fa-solid fa-users mr-1"></i> Alumnos
                                        </button>
                                        <button
                                            onClick={() => setActiveTab('añadir-alumno')}
                                            className={`py-2 px-4 font-bold ${activeTab === 'añadir-alumno' ? 'text-blue-600 border-b-2 border-blue-600' : 'text-gray-600'}`}
                                        >
                                            <i className="fa-solid fa-user-plus mr-1"></i> Añadir Alumno
                                        </button>
                                        <button
                                            onClick={() => setActiveTab('actividad')}
                                            className={`py-2 px-4 font-bold ${activeTab === 'actividad' ? 'text-blue-600 border-b-2 border-blue-600' : 'text-gray-600'}`}
                                        >
                                            <i className="fa-solid fa-history mr-1"></i> Actividad
                                        </button>
                                    </div>
                                </div>

                                {/* Contenido de las pestañas */}
                                <div className="p-4">
                                    {activeTab === 'clases' && (
                                        <div id="report-section">
                                            <h2 className="text-2xl font-bold text-gray-800 mb-4 text-center">
                                                Resumen de Clases
                                            </h2>
                                            <div className="flex justify-between items-center mb-4">
                                                <div className="flex items-center space-x-2">
                                                    <label className="text-gray-700">Filtrar por Mes:</label>
                                                    <input
                                                        type="month"
                                                        value={selectedMonth}
                                                        onChange={handleMonthChange}
                                                        className="p-2 border rounded-lg"
                                                    />
                                                </div>
                                                <button onClick={generateReport} className="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                                                    <i className="fa-solid fa-file-pdf mr-1"></i> Generar Reporte PDF
                                                </button>
                                            </div>
                                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                                                <div className="bg-blue-100 p-4 rounded-lg shadow">
                                                    <h3 className="font-bold text-blue-800">Clases Totales</h3>
                                                    <p className="text-2xl font-bold text-blue-800">{totalClasses}</p>
                                                </div>
                                                <div className="bg-blue-100 p-4 rounded-lg shadow">
                                                    <h3 className="font-bold text-blue-800">Ingresos Totales</h3>
                                                    <p className="text-2xl font-bold text-blue-800">$ {classes.reduce((sum, c) => sum + parseFloat(c.cost || 0), 0).toFixed(2)}</p>
                                                </div>
                                                <div className="bg-green-100 p-4 rounded-lg shadow">
                                                    <h3 className="font-bold text-green-800">Ingresos Cobrados</h3>
                                                    <p className="text-2xl font-bold text-green-800">$ {classes.filter(c => c.isPaid).reduce((sum, c) => sum + parseFloat(c.cost || 0), 0).toFixed(2)}</p>
                                                </div>
                                                <div className="bg-red-100 p-4 rounded-lg shadow">
                                                    <h3 className="font-bold text-red-800">Ingresos Pendientes</h3>
                                                    <p className="text-2xl font-bold text-red-800">$ {classes.filter(c => !c.isPaid).reduce((sum, c) => sum + parseFloat(c.cost || 0), 0).toFixed(2)}</p>
                                                </div>
                                            </div>

                                            <div className="bg-white shadow rounded-lg overflow-hidden">
                                                {classes.length > 0 ? (
                                                    <table className="min-w-full divide-y divide-gray-200">
                                                        <thead className="bg-gray-50">
                                                            <tr>
                                                                <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Fecha</th>
                                                                <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Hora</th>
                                                                <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Lugar</th>
                                                                <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Alumnos</th>
                                                                <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Costo</th>
                                                                <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Estado</th>
                                                                <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Acciones</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody className="bg-white divide-y divide-gray-200">
                                                            {classes.sort((a, b) => b.date.localeCompare(a.date)).map((c) => (
                                                                <tr key={c.id}>
                                                                    <td className="px-4 py-2 whitespace-nowrap text-sm text-gray-900">{c.date}</td>
                                                                    <td className="px-4 py-2 whitespace-nowrap text-sm text-gray-900">{c.time}</td>
                                                                    <td className="px-4 py-2 whitespace-nowrap text-sm text-gray-900">{c.location}</td>
                                                                    <td className="px-4 py-2 whitespace-nowrap text-sm text-gray-900">{c.studentNames.join(', ')}</td>
                                                                    <td className="px-4 py-2 whitespace-nowrap text-sm text-gray-900">$ {c.cost}</td>
                                                                    <td className="px-4 py-2 whitespace-nowrap text-sm">
                                                                        <span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${c.isPaid ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>
                                                                            {c.isPaid ? 'Pagado' : 'Pendiente'}
                                                                        </span>
                                                                    </td>
                                                                    <td className="px-4 py-2 whitespace-nowrap text-sm font-medium">
                                                                        <button onClick={() => startEditingClass(c)} className="text-indigo-600 hover:text-indigo-900 mr-2">
                                                                            <i className="fa-solid fa-edit"></i>
                                                                        </button>
                                                                        <button onClick={() => deleteClass(c.id, c.date)} className="text-red-600 hover:text-red-900">
                                                                            <i className="fa-solid fa-trash-alt"></i>
                                                                        </button>
                                                                    </td>
                                                                </tr>
                                                            ))}
                                                        </tbody>
                                                    </table>
                                                ) : (
                                                    <p className="text-center text-gray-500 p-8">No hay clases registradas aún.</p>
                                                )}
                                            </div>
                                        </div>
                                    )}

                                    {activeTab === 'añadir-clase' && (
                                        <div>
                                            <h2 className="text-2xl font-bold text-gray-800 mb-4 text-center">{editingClassId ? 'Editar Clase' : 'Añadir Nueva Clase'}</h2>
                                            {error && <div className="text-red-500 text-center mb-4">{error}</div>}
                                            <form onSubmit={editingClassId ? editClass : addClass} className="space-y-4">
                                                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                                                    <div>
                                                        <label className="block text-gray-700 font-medium text-sm">Fecha</label>
                                                        <input
                                                            type="date"
                                                            name="date"
                                                            value={newEntry.date}
                                                            onChange={handleNewEntryChange}
                                                            className="mt-1 p-2 w-full border rounded-lg focus:ring-2 focus:ring-blue-500 transition-shadow"
                                                            required
                                                        />
                                                    </div>
                                                    <div>
                                                        <label className="block text-gray-700 font-medium text-sm">Hora</label>
                                                        <input
                                                            type="time"
                                                            name="time"
                                                            value={newEntry.time}
                                                            onChange={handleNewEntryChange}
                                                            className="mt-1 p-2 w-full border rounded-lg focus:ring-2 focus:ring-blue-500 transition-shadow"
                                                        />
                                                    </div>
                                                    <div>
                                                        <label className="block text-gray-700 font-medium text-sm">Lugar</label>
                                                        <input
                                                            type="text"
                                                            name="location"
                                                            value={newEntry.location}
                                                            onChange={handleNewEntryChange}
                                                            className="mt-1 p-2 w-full border rounded-lg focus:ring-2 focus:ring-blue-500 transition-shadow"
                                                            placeholder="Ej: Complejo Los Troncos"
                                                            required
                                                        />
                                                    </div>
                                                    <div>
                                                        <label className="block text-gray-700 font-medium text-sm">Duración (opcional)</label>
                                                        <input
                                                            type="text"
                                                            name="duration"
                                                            value={newEntry.duration}
                                                            onChange={handleNewEntryChange}
                                                            className="mt-1 p-2 w-full border rounded-lg focus:ring-2 focus:ring-blue-500 transition-shadow"
                                                            placeholder="Ej: 1h"
                                                        />
                                                    </div>
                                                    <div>
                                                        <label className="block text-gray-700 font-medium text-sm">Costo</label>
                                                        <input
                                                            type="number"
                                                            name="cost"
                                                            value={newEntry.cost}
                                                            onChange={handleNewEntryChange}
                                                            className="mt-1 p-2 w-full border rounded-lg focus:ring-2 focus:ring-blue-500 transition-shadow"
                                                            required
                                                        />
                                                    </div>
                                                    <div className="flex items-center mt-6">
                                                        <input
                                                            type="checkbox"
                                                            id="isPaid"
                                                            name="isPaid"
                                                            checked={newEntry.isPaid}
                                                            onChange={handleNewEntryChange}
                                                            className="h-5 w-5 text-blue-600 rounded"
                                                        />
                                                        <label htmlFor="isPaid" className="ml-2 text-gray-700 font-medium">¿Clase pagada?</label>
                                                    </div>
                                                </div>

                                                <div className="mt-4 border-t pt-4">
                                                    <h3 className="font-bold text-gray-700 mb-2">Alumnos de la Clase</h3>
                                                    <div className="flex flex-wrap gap-4">
                                                        {newEntry.studentNames.map((name, index) => (
                                                            <div key={index} className="flex-1">
                                                                <label className="block text-gray-700 font-medium text-sm">
                                                                    Alumno {index + 1}
                                                                </label>
                                                                <input
                                                                    type="text"
                                                                    name={`studentName-${index}`}
                                                                    value={name}
                                                                    onChange={handleNewEntryChange}
                                                                    className="mt-1 p-2 w-full border rounded-lg focus:ring-2 focus:ring-blue-500 transition-shadow"
                                                                    placeholder="Nombre del alumno"
                                                                    list="student-list"
                                                                />
                                                                <datalist id="student-list">
                                                                    {students.sort((a, b) => (a.firstName + ' ' + a.lastName).localeCompare(b.firstName + ' ' + b.lastName)).map(student => (
                                                                        <option key={student.id} value={`${student.firstName} ${student.lastName}`} />
                                                                    ))}
                                                                </datalist>
                                                            </div>
                                                        ))}
                                                        {newEntry.studentNames.length < 4 && (
                                                            <button
                                                                type="button"
                                                                onClick={() => setNewEntry({ ...newEntry, studentNames: [...newEntry.studentNames, ''] })}
                                                                className="mt-6 h-10 w-10 flex items-center justify-center bg-gray-200 text-gray-600 rounded-full hover:bg-gray-300 transition-colors"
                                                            >
                                                                <i className="fa-solid fa-plus"></i>
                                                            </button>
                                                        )}
                                                        {newEntry.studentNames.length > 1 && (
                                                            <button
                                                                type="button"
                                                                onClick={() => {
                                                                    const newStudentNames = [...newEntry.studentNames];
                                                                    newStudentNames.pop();
                                                                    setNewEntry({ ...newEntry, studentNames: newStudentNames });
                                                                }}
                                                                className="mt-6 h-10 w-10 flex items-center justify-center bg-gray-200 text-gray-600 rounded-full hover:bg-gray-300 transition-colors"
                                                            >
                                                                <i className="fa-solid fa-minus"></i>
                                                            </button>
                                                        )}
                                                    </div>
                                                </div>

                                                <button type="submit" className="w-full bg-blue-600 text-white font-bold p-3 rounded-lg hover:bg-blue-700 transition-colors">
                                                    {editingClassId ? 'Guardar Cambios' : 'Añadir Clase'}
                                                </button>
                                            </form>
                                        </div>
                                    )}

                                    {activeTab === 'alumnos' && (
                                        <div>
                                            <h2 className="text-2xl font-bold text-gray-800 mb-4 text-center">
                                                Lista de Alumnos
                                            </h2>
                                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4">
                                                <div className="bg-blue-100 p-4 rounded-lg shadow col-span-1 lg:col-span-3 text-center">
                                                    <h3 className="font-bold text-blue-800">Alumnos Totales</h3>
                                                    <p className="text-2xl font-bold text-blue-800">{totalStudents}</p>
                                                </div>
                                            </div>
                                            <div className="bg-white shadow rounded-lg overflow-hidden">
                                                {students.length > 0 ? (
                                                    <table className="min-w-full divide-y divide-gray-200">
                                                        <thead className="bg-gray-50">
                                                            <tr>
                                                                <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Nombre Completo</th>
                                                                <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Teléfono</th>
                                                                <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Notas</th>
                                                                <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Acciones</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody className="bg-white divide-y divide-gray-200">
                                                            {students.sort((a, b) => (a.firstName + ' ' + a.lastName).localeCompare(b.firstName + ' ' + b.lastName)).map((s) => (
                                                                <tr key={s.id}>
                                                                    <td className="px-4 py-2 whitespace-nowrap text-sm text-gray-900">{s.firstName} {s.lastName}</td>
                                                                    <td className="px-4 py-2 whitespace-nowrap text-sm text-gray-900">{s.phoneNumber}</td>
                                                                    <td className="px-4 py-2 whitespace-nowrap text-sm text-gray-900">{s.notes}</td>
                                                                    <td className="px-4 py-2 whitespace-nowrap text-sm font-medium">
                                                                        <button onClick={() => startEditingStudent(s)} className="text-indigo-600 hover:text-indigo-900 mr-2">
                                                                            <i className="fa-solid fa-edit"></i>
                                                                        </button>
                                                                        <button onClick={() => deleteStudent(s.id, `${s.firstName} ${s.lastName}`)} className="text-red-600 hover:text-red-900">
                                                                            <i className="fa-solid fa-trash-alt"></i>
                                                                        </button>
                                                                    </td>
                                                                </tr>
                                                            ))}
                                                        </tbody>
                                                    </table>
                                                ) : (
                                                    <p className="text-center text-gray-500 p-8">No hay alumnos registrados aún.</p>
                                                )}
                                            </div>
                                        </div>
                                    )}

                                    {activeTab === 'añadir-alumno' && (
                                        <div>
                                            <h2 className="text-2xl font-bold text-gray-800 mb-4 text-center">{editingStudentId ? 'Editar Alumno' : 'Añadir Nuevo Alumno'}</h2>
                                            {error && <div className="text-red-500 text-center mb-4">{error}</div>}
                                            <form onSubmit={editingStudentId ? editStudent : addStudent} className="space-y-4">
                                                <div>
                                                    <label className="block text-gray-700 font-medium">Nombre</label>
                                                    <input
                                                        type="text"
                                                        name="firstName"
                                                        value={newStudent.firstName}
                                                        onChange={handleStudentChange}
                                                        className="mt-1 p-2 w-full border rounded-lg focus:ring-2 focus:ring-blue-500 transition-shadow"
                                                        required
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-gray-700 font-medium">Apellido</label>
                                                    <input
                                                        type="text"
                                                        name="lastName"
                                                        value={newStudent.lastName}
                                                        onChange={handleStudentChange}
                                                        className="mt-1 p-2 w-full border rounded-lg focus:ring-2 focus:ring-blue-500 transition-shadow"
                                                        required
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-gray-700 font-medium">Teléfono (opcional)</label>
                                                    <input
                                                        type="tel"
                                                        name="phoneNumber"
                                                        value={newStudent.phoneNumber}
                                                        onChange={handleStudentChange}
                                                        className="mt-1 p-2 w-full border rounded-lg focus:ring-2 focus:ring-blue-500 transition-shadow"
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-gray-700 font-medium">Notas (opcional)</label>
                                                    <textarea
                                                        name="notes"
                                                        value={newStudent.notes}
                                                        onChange={handleStudentChange}
                                                        rows="3"
                                                        className="mt-1 p-2 w-full border rounded-lg focus:ring-2 focus:ring-blue-500 transition-shadow"
                                                    ></textarea>
                                                </div>
                                                <button type="submit" className="w-full bg-blue-600 text-white font-bold p-3 rounded-lg hover:bg-blue-700 transition-colors">
                                                    {editingStudentId ? 'Guardar Cambios' : 'Añadir Alumno'}
                                                </button>
                                            </form>
                                        </div>
                                    )}

                                    {activeTab === 'actividad' && (
                                        <div className="bg-white shadow rounded-lg p-6">
                                            <h2 className="text-2xl font-bold text-gray-800 mb-4 text-center">Registro de Actividad Reciente</h2>
                                            {userActivity.length > 0 ? (
                                                <div className="flow-root">
                                                    <ul role="list" className="-mb-8">
                                                        {userActivity.map((log, index) => (
                                                            <li key={index}>
                                                                <div className="relative pb-8">
                                                                    {index !== userActivity.length - 1 && (
                                                                        <span className="absolute top-4 left-4 -ml-px h-full w-0.5 bg-gray-200" aria-hidden="true"></span>
                                                                    )}
                                                                    <div className="relative flex space-x-3">
                                                                        <div>
                                                                            <span className="h-8 w-8 rounded-full bg-blue-500 flex items-center justify-center ring-8 ring-white">
                                                                                <i className="fa-solid fa-list-check text-white"></i>
                                                                            </span>
                                                                        </div>
                                                                        <div className="min-w-0 flex-1 pt-1.5 flex justify-between space-x-4">
                                                                            <div>
                                                                                <span className="font-bold text-blue-800 uppercase mr-2">{log.action}:</span>
                                                                                <span className="text-gray-700">{log.details}</span>
                                                                            </div>
                                                                            <span className="text-gray-500 text-xs">{formatDate(log.timestamp)}</span>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </li>
                                                        ))}
                                                    </ul>
                                                </div>
                                            ) : (
                                                <p className="text-center text-gray-500 p-8 bg-white">No hay actividad reciente.</p>
                                            )}
                                        </div>
                                    )}
                                </div>
                                {userId && (
                                    <div className="mt-8 text-center text-gray-500">
                                        ID de Usuario: <span className="font-mono">{userId}</span>
                                    </div>
                                )}
                            </>
                        )}
                    </div>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
