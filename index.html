<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Informe de Clases de Padel</title>

    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged, createUserWithEmailAndPassword, sendPasswordResetEmail, browserSessionPersistence, setPersistence } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getDatabase, ref, get, set, push, update, remove, onValue, child, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-database.js";

        // Configuración de Firebase - Reemplaza con tus propias claves
       const firebaseConfig = {
  apiKey: "AIzaSyAvk1yOsxXfc2w4YwZ1R1tQFrQuM2AbEYk",
  authDomain: "app-de-padel.firebaseapp.com",
  projectId: "app-de-padel",
  storageBucket: "app-de-padel.firebasestorage.app",
  messagingSenderId: "731771747398",
  appId: "1:731771747398:web:ebc8b723fe220869fade47"
};

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        const { useState, useEffect, useRef } = React;
        const { render } = ReactDOM;

        // Función para limpiar tildes y convertir a minúsculas para un mejor filtrado
        const normalizeText = (text) => {
            return text.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();
        };

        // Componente reutilizable para el autocompletado
        const AutocompleteInput = ({ value, onChange, onSelect, allSuggestions, placeholder }) => {
            const [filteredSuggestions, setFilteredSuggestions] = useState([]);
            const [showSuggestions, setShowSuggestions] = useState(false);
            const [activeSuggestionIndex, setActiveSuggestionIndex] = useState(-1);
            const inputRef = useRef(null);

            useEffect(() => {
                if (value) {
                    const normalizedValue = normalizeText(value);
                    const filtered = allSuggestions.filter(suggestion =>
                        normalizeText(suggestion).includes(normalizedValue)
                    );
                    setFilteredSuggestions(filtered);
                    setShowSuggestions(true);
                    setActiveSuggestionIndex(-1); // Reset active index when suggestions change
                } else {
                    setFilteredSuggestions([]);
                    setShowSuggestions(false);
                }
            }, [value, allSuggestions]);

            const handleKeyDown = (e) => {
                // Up arrow
                if (e.key === 'ArrowUp') {
                    if (activeSuggestionIndex <= 0) {
                        setActiveSuggestionIndex(filteredSuggestions.length - 1);
                    } else {
                        setActiveSuggestionIndex(activeSuggestionIndex - 1);
                    }
                }
                // Down arrow
                else if (e.key === 'ArrowDown') {
                    if (activeSuggestionIndex === filteredSuggestions.length - 1) {
                        setActiveSuggestionIndex(0);
                    } else {
                        setActiveSuggestionIndex(activeSuggestionIndex + 1);
                    }
                }
                // Enter key
                else if (e.key === 'Enter') {
                    e.preventDefault();
                    if (activeSuggestionIndex >= 0) {
                        onSelect(filteredSuggestions[activeSuggestionIndex]);
                    } else if (filteredSuggestions.length > 0) {
                        onSelect(filteredSuggestions[0]);
                    }
                    setShowSuggestions(false);
                }
                // Escape key
                else if (e.key === 'Escape') {
                    setShowSuggestions(false);
                }
            };

            const handleBlur = () => {
                setTimeout(() => {
                    setShowSuggestions(false);
                }, 200);
            };

            const handleClick = (suggestion) => {
                onSelect(suggestion);
                setShowSuggestions(false);
            };

            return (
                <div className="relative">
                    <input
                        type="text"
                        className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                        value={value}
                        onChange={onChange}
                        onKeyDown={handleKeyDown}
                        onFocus={() => setShowSuggestions(true)}
                        onBlur={handleBlur}
                        placeholder={placeholder}
                        autoComplete="off"
                        ref={inputRef}
                    />
                    {showSuggestions && filteredSuggestions.length > 0 && (
                        <ul className="absolute z-10 w-full bg-white border border-gray-300 rounded-md shadow-lg max-h-40 overflow-auto mt-1">
                            {filteredSuggestions.map((suggestion, index) => (
                                <li
                                    key={suggestion}
                                    className={`px-4 py-2 cursor-pointer hover:bg-gray-100 ${index === activeSuggestionIndex ? 'bg-gray-200' : ''}`}
                                    onClick={() => handleClick(suggestion)}
                                    onMouseDown={(e) => e.preventDefault()} // Prevent blur from firing
                                >
                                    {suggestion}
                                </li>
                            ))}
                        </ul>
                    )}
                </div>
            );
        };

        const App = () => {
            const [classes, setClasses] = useState({});
            const [payments, setPayments] = useState({});
            const [students, setStudents] = useState({});
            const [editingClass, setEditingClass] = useState(null);
            const [newClass, setNewClass] = useState({ date: '', time: '', students: [], pricePerStudent: '' });
            const [showAddClassModal, setShowAddClassModal] = useState(false);
            const [showEditClassModal, setShowEditClassModal] = useState(false);
            const [showLoginModal, setShowLoginModal] = useState(false);
            const [showRegisterModal, setShowRegisterModal] = useState(false);
            const [showResetPasswordModal, setShowResetPasswordModal] = useState(false);
            const [showAddStudentModal, setShowAddStudentModal] = useState(false);
            const [newStudentName, setNewStudentName] = useState('');
            const [editingStudent, setEditingStudent] = useState(null);
            const [showEditStudentModal, setShowEditStudentModal] = useState(false);
            const [showAddPaymentModal, setShowAddPaymentModal] = useState(false);
            const [newPayment, setNewPayment] = useState({ date: '', amount: '', description: '' });
            const [editingPayment, setEditingPayment] = useState(null);
            const [showEditPaymentModal, setShowEditPaymentModal] = useState(false);
            const [showReportsModal, setShowReportsModal] = useState(false);
            const [reportDate, setReportDate] = useState('');
            const [report, setReport] = useState(null);
            const [activeTab, setActiveTab] = useState('clases');
            const [searchText, setSearchText] = useState('');
            const [filteredClasses, setFilteredClasses] = useState({});
            const [userId, setUserId] = useState(null);
            const [activityLogs, setActivityLogs] = useState([]);
            const [userEmail, setUserEmail] = useState('');

            const classCounts = Object.keys(classes).length;

            useEffect(() => {
                const unsubscribe = onAuthStateChanged(auth, (user) => {
                    if (user) {
                        setUserId(user.uid);
                        setUserEmail(user.email);
                        setPersistence(auth, browserSessionPersistence);
                        fetchData(user.uid);
                    } else {
                        setUserId(null);
                        setClasses({});
                        setPayments({});
                        setStudents({});
                        setActivityLogs([]);
                        setShowLoginModal(true);
                    }
                });
                return () => unsubscribe();
            }, []);

            useEffect(() => {
                const searchLower = normalizeText(searchText);
                if (searchLower === '') {
                    setFilteredClasses(classes);
                } else {
                    const filtered = Object.fromEntries(
                        Object.entries(classes).filter(([id, classData]) =>
                            normalizeText(classData.date).includes(searchLower) ||
                            normalizeText(classData.time).includes(searchLower) ||
                            (classData.students && classData.students.some(student =>
                                normalizeText(student.name).includes(searchLower)
                            ))
                        )
                    );
                    setFilteredClasses(filtered);
                }
            }, [searchText, classes]);

            const fetchData = (uid) => {
                if (uid) {
                    const classesRef = ref(db, `users/${uid}/classes`);
                    onValue(classesRef, (snapshot) => {
                        const data = snapshot.val() || {};
                        setClasses(data);
                        setFilteredClasses(data);
                    });

                    const studentsRef = ref(db, `users/${uid}/students`);
                    onValue(studentsRef, (snapshot) => {
                        const data = snapshot.val() || {};
                        setStudents(data);
                    });

                    const paymentsRef = ref(db, `users/${uid}/payments`);
                    onValue(paymentsRef, (snapshot) => {
                        const data = snapshot.val() || {};
                        setPayments(data);
                    });

                    const activityRef = ref(db, `users/${uid}/activityLogs`);
                    onValue(activityRef, (snapshot) => {
                        const data = snapshot.val() || {};
                        const logsArray = Object.values(data).sort((a, b) => b.timestamp - a.timestamp);
                        setActivityLogs(logsArray);
                    });
                }
            };

            const addLog = (action, details) => {
                if (userId) {
                    const newLogRef = push(ref(db, `users/${userId}/activityLogs`));
                    set(newLogRef, {
                        action: action,
                        details: details,
                        timestamp: serverTimestamp()
                    });
                }
            };

            const handleLogout = async () => {
                try {
                    await signOut(auth);
                    console.log("Sesión cerrada.");
                } catch (error) {
                    console.error("Error al cerrar sesión:", error);
                    alert("Error al cerrar sesión: " + error.message);
                }
            };

            const handleLogin = async (email, password) => {
                try {
                    await signInWithEmailAndPassword(auth, email, password);
                    setShowLoginModal(false);
                } catch (error) {
                    alert("Error de inicio de sesión: " + error.message);
                }
            };

            const handleRegister = async (email, password) => {
                try {
                    await createUserWithEmailAndPassword(auth, email, password);
                    setShowRegisterModal(false);
                } catch (error) {
                    alert("Error de registro: " + error.message);
                }
            };

            const handleResetPassword = async (email) => {
                try {
                    await sendPasswordResetEmail(auth, email);
                    alert("Se ha enviado un correo para restablecer tu contraseña.");
                    setShowResetPasswordModal(false);
                } catch (error) {
                    alert("Error al restablecer la contraseña: " + error.message);
                }
            };

            const handleNewClassChange = (e) => {
                const { name, value } = e.target;
                let updatedNewClass = { ...newClass, [name]: value };

                if (name === 'studentsCount') {
                    const count = parseInt(value, 10);
                    const newStudents = Array.from({ length: count }, (_, i) => updatedNewClass.students[i] || { name: '', paid: false });
                    updatedNewClass.students = newStudents;
                }

                setNewClass(updatedNewClass);
            };

            const handleStudentInputChange = (e, index) => {
                const newStudents = [...newClass.students];
                newStudents[index] = { ...newStudents[index], name: e.target.value };
                setNewClass({ ...newClass, students: newStudents });
            };

            const handleStudentSelect = (selectedStudentName, index) => {
                const newStudents = [...newClass.students];
                newStudents[index] = { ...newStudents[index], name: selectedStudentName };
                setNewClass({ ...newClass, students: newStudents });
            };

            const addClass = async () => {
                if (!newClass.date || !newClass.time || !newClass.students.length || newClass.students.some(s => !s.name) || !newClass.pricePerStudent) {
                    alert("Por favor, completa todos los campos.");
                    return;
                }

                const price = parseFloat(newClass.pricePerStudent);
                if (isNaN(price) || price <= 0) {
                    alert("El precio por alumno debe ser un número positivo.");
                    return;
                }

                const newClassData = {
                    ...newClass,
                    pricePerStudent: price,
                    students: newClass.students.map(s => ({ ...s, paid: s.paid || false })),
                    timestamp: serverTimestamp()
                };

                try {
                    const newClassRef = push(ref(db, `users/${userId}/classes`));
                    await set(newClassRef, newClassData);
                    addLog('Clase Añadida', `Clase del ${newClassData.date} a las ${newClassData.time} con ${newClassData.students.length} alumnos.`);
                    resetForm();
                    setShowAddClassModal(false);
                } catch (error) {
                    console.error("Error adding class: ", error);
                    alert("Error al añadir la clase: " + error.message);
                }
            };

            const deleteClass = async (id) => {
                if (window.confirm("¿Estás seguro de que quieres eliminar esta clase?")) {
                    try {
                        const classRef = ref(db, `users/${userId}/classes/${id}`);
                        await remove(classRef);
                        addLog('Clase Eliminada', `Clase del ${classes[id].date} a las ${classes[id].time}.`);
                    } catch (error) {
                        console.error("Error removing class: ", error);
                        alert("Error al eliminar la clase: " + error.message);
                    }
                }
            };

            const editClass = (id, classData) => {
                setEditingClass({ id, ...classData });
                setShowEditClassModal(true);
            };

            const saveEditedClass = async () => {
                if (!editingClass.date || !editingClass.time || !editingClass.students.length || editingClass.students.some(s => !s.name)) {
                    alert("Por favor, completa todos los campos.");
                    return;
                }

                const price = parseFloat(editingClass.pricePerStudent);
                if (isNaN(price) || price <= 0) {
                    alert("El precio por alumno debe ser un número positivo.");
                    return;
                }

                const updatedClassData = {
                    ...editingClass,
                    pricePerStudent: price,
                    students: editingClass.students.map(s => ({ ...s, paid: s.paid || false }))
                };

                try {
                    const classRef = ref(db, `users/${userId}/classes/${editingClass.id}`);
                    await update(classRef, updatedClassData);
                    addLog('Clase Editada', `Clase del ${updatedClassData.date} a las ${updatedClassData.time}.`);
                    setShowEditClassModal(false);
                    setEditingClass(null);
                } catch (error) {
                    console.error("Error updating class: ", error);
                    alert("Error al actualizar la clase: " + error.message);
                }
            };

            const handleEditedClassChange = (e) => {
                const { name, value } = e.target;
                setEditingClass(prev => ({ ...prev, [name]: value }));
            };

            const handleEditedStudentChange = (e, index) => {
                const { value } = e.target;
                const newStudents = [...editingClass.students];
                newStudents[index] = { ...newStudents[index], name: value };
                setEditingClass(prev => ({ ...prev, students: newStudents }));
            };

            const handleEditedStudentSelect = (selectedStudentName, index) => {
                const newStudents = [...editingClass.students];
                newStudents[index] = { ...newStudents[index], name: selectedStudentName };
                setEditingClass(prev => ({ ...prev, students: newStudents }));
            };

            const handleStudentPaidChange = (index) => {
                const newStudents = [...editingClass.students];
                newStudents[index] = { ...newStudents[index], paid: !newStudents[index].paid };
                setEditingClass(prev => ({ ...prev, students: newStudents }));
            };

            const resetForm = () => {
                setNewClass({ date: '', time: '', students: [], pricePerStudent: '' });
            };

            const addStudent = async () => {
                if (!newStudentName) {
                    alert("Por favor, ingresa un nombre para el alumno.");
                    return;
                }

                try {
                    const newStudentData = { name: newStudentName, timestamp: serverTimestamp() };
                    const newStudentRef = push(ref(db, `users/${userId}/students`));
                    await set(newStudentRef, newStudentData);
                    addLog('Alumno Añadido', `Nuevo alumno: ${newStudentName}.`);
                    setNewStudentName('');
                    setShowAddStudentModal(false);
                } catch (error) {
                    console.error("Error adding student: ", error);
                    alert("Error al añadir el alumno: " + error.message);
                }
            };

            const deleteStudent = async (id) => {
                if (window.confirm("¿Estás seguro de que quieres eliminar este alumno?")) {
                    try {
                        const studentRef = ref(db, `users/${userId}/students/${id}`);
                        await remove(studentRef);
                        addLog('Alumno Eliminado', `Alumno ${students[id].name} eliminado.`);
                    } catch (error) {
                        console.error("Error removing student: ", error);
                        alert("Error al eliminar el alumno: " + error.message);
                    }
                }
            };

            const editStudent = (id, studentData) => {
                setEditingStudent({ id, ...studentData });
                setNewStudentName(studentData.name);
                setShowEditStudentModal(true);
            };

            const saveEditedStudent = async () => {
                if (!newStudentName) {
                    alert("Por favor, ingresa un nombre para el alumno.");
                    return;
                }

                try {
                    const studentRef = ref(db, `users/${userId}/students/${editingStudent.id}`);
                    await update(studentRef, { name: newStudentName });
                    addLog('Alumno Editado', `Nombre del alumno ${editingStudent.name} cambiado a ${newStudentName}.`);
                    setShowEditStudentModal(false);
                    setEditingStudent(null);
                    setNewStudentName('');
                } catch (error) {
                    console.error("Error updating student: ", error);
                    alert("Error al actualizar el alumno: " + error.message);
                }
            };

            const addPayment = async () => {
                if (!newPayment.date || !newPayment.amount || !newPayment.description) {
                    alert("Por favor, completa todos los campos del pago.");
                    return;
                }

                const amount = parseFloat(newPayment.amount);
                if (isNaN(amount) || amount <= 0) {
                    alert("El monto debe ser un número positivo.");
                    return;
                }

                const newPaymentData = {
                    ...newPayment,
                    amount: amount,
                    timestamp: serverTimestamp()
                };

                try {
                    const newPaymentRef = push(ref(db, `users/${userId}/payments`));
                    await set(newPaymentRef, newPaymentData);
                    addLog('Pago Añadido', `Pago de ${newPaymentData.amount}€ del ${newPaymentData.date}.`);
                    setNewPayment({ date: '', amount: '', description: '' });
                    setShowAddPaymentModal(false);
                } catch (error) {
                    console.error("Error adding payment: ", error);
                    alert("Error al añadir el pago: " + error.message);
                }
            };

            const editPayment = (id, paymentData) => {
                setEditingPayment({ id, ...paymentData });
                setShowEditPaymentModal(true);
            };

            const saveEditedPayment = async () => {
                if (!editingPayment.date || !editingPayment.amount || !editingPayment.description) {
                    alert("Por favor, completa todos los campos.");
                    return;
                }

                const amount = parseFloat(editingPayment.amount);
                if (isNaN(amount) || amount <= 0) {
                    alert("El monto debe ser un número positivo.");
                    return;
                }

                try {
                    const paymentRef = ref(db, `users/${userId}/payments/${editingPayment.id}`);
                    await update(paymentRef, { ...editingPayment, amount: amount });
                    addLog('Pago Editado', `Pago del ${editingPayment.date} por ${amount}€ actualizado.`);
                    setShowEditPaymentModal(false);
                    setEditingPayment(null);
                } catch (error) {
                    console.error("Error updating payment: ", error);
                    alert("Error al actualizar el pago: " + error.message);
                }
            };

            const deletePayment = async (id) => {
                if (window.confirm("¿Estás seguro de que quieres eliminar este pago?")) {
                    try {
                        const paymentRef = ref(db, `users/${userId}/payments/${id}`);
                        await remove(paymentRef);
                        addLog('Pago Eliminado', `Pago del ${payments[id].date} por ${payments[id].amount}€ eliminado.`);
                    } catch (error) {
                        console.error("Error removing payment: ", error);
                        alert("Error al eliminar el pago: " + error.message);
                    }
                }
            };

            const generateReport = () => {
                if (!reportDate) {
                    alert("Por favor, selecciona un mes y año para generar el informe.");
                    return;
                }

                const [year, month] = reportDate.split('-');
                const filteredClasses = Object.values(classes).filter(c => {
                    const classDate = new Date(c.date);
                    return classDate.getFullYear() == year && (classDate.getMonth() + 1) == month;
                });

                const filteredPayments = Object.values(payments).filter(p => {
                    const paymentDate = new Date(p.date);
                    return paymentDate.getFullYear() == year && (paymentDate.getMonth() + 1) == month;
                });

                let totalRevenue = 0;
                let classesCount = filteredClasses.length;
                let totalStudents = 0;

                filteredClasses.forEach(c => {
                    const studentsPaid = c.students.filter(s => s.paid).length;
                    totalRevenue += studentsPaid * c.pricePerStudent;
                    totalStudents += c.students.length;
                });

                let totalPayments = filteredPayments.reduce((sum, p) => sum + p.amount, 0);

                setReport({
                    month: reportDate,
                    totalRevenue,
                    totalPayments,
                    classesCount,
                    totalStudents
                });
            };

            const exportData = async () => {
                const data = {
                    classes: classes,
                    payments: payments,
                    students: students
                };
                const json = JSON.stringify(data, null, 2);
                const blob = new Blob([json], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'datos_padel.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                addLog('Datos Exportados', 'Los datos se han exportado en formato JSON.');
            };

            const importData = async (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = async (event) => {
                    try {
                        const importedData = JSON.parse(event.target.result);
                        if (window.confirm("¿Estás seguro de que quieres importar estos datos? Esto sobrescribirá los datos actuales.")) {
                            const updates = {};
                            if (importedData.classes) {
                                updates[`users/${userId}/classes`] = importedData.classes;
                            }
                            if (importedData.payments) {
                                updates[`users/${userId}/payments`] = importedData.payments;
                            }
                            if (importedData.students) {
                                updates[`users/${userId}/students`] = importedData.students;
                            }
                            await update(ref(db), updates);
                            addLog('Datos Importados', 'Los datos se han importado desde un archivo JSON.');
                            alert("Datos importados con éxito.");
                        }
                    } catch (error) {
                        alert("Error al importar datos: " + error.message);
                        console.error("Error al importar datos:", error);
                    }
                };
                reader.readAsText(file);
            };

            const formatCurrency = (amount) => {
                return new Intl.NumberFormat('es-ES', { style: 'currency', currency: 'EUR' }).format(amount);
            };

            const formatDate = (dateString) => {
                if (!dateString) return 'N/A';
                const date = new Date(dateString);
                const options = { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' };
                return new Intl.DateTimeFormat('es-ES', options).format(date);
            };

            const printReport = () => {
                window.print();
            };

            const ClassTable = ({ classesData, onDelete, onEdit }) => {
                return (
                    <div className="overflow-x-auto">
                        <table className="min-w-full divide-y divide-gray-200">
                            <thead className="bg-gray-50">
                                <tr>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fecha</th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Hora</th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Alumnos</th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Precio por Alumno</th>
                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
                                </tr>
                            </thead>
                            <tbody className="bg-white divide-y divide-gray-200">
                                {Object.entries(classesData).map(([id, classData]) => (
                                    <tr key={id}>
                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{classData.date}</td>
                                        <td className="px-6 py-4 whitespace-now-900">{classData.time}</td>
                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                            {classData.students && classData.students.map((student, index) => (
                                                <div key={index}>
                                                    {student.name} {student.paid && <span className="text-green-500"><i className="fas fa-check-circle"></i></span>}
                                                </div>
                                            ))}
                                        </td>
                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{formatCurrency(classData.pricePerStudent)}</td>
                                        <td className="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                            <button onClick={() => onEdit(id, classData)} className="text-indigo-600 hover:text-indigo-900 mr-2"><i className="fas fa-edit"></i></button>
                                            <button onClick={() => onDelete(id)} className="text-red-600 hover:text-red-900"><i className="fas fa-trash-alt"></i></button>
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                );
            };

            const AddClassModal = ({ isOpen, onClose, newClass, onNewClassChange, handleStudentInputChange, handleStudentSelect, allStudents }) => {
                if (!isOpen) return null;

                const studentInputs = Array.from({ length: parseInt(newClass.students.length, 10) }, (_, index) => (
                    <div key={index}>
                        <label htmlFor={`studentName-${index}`} className="block text-sm font-medium text-gray-700">Alumno {index + 1}</label>
                        <AutocompleteInput
                            value={newClass.students[index] ? newClass.students[index].name : ''}
                            onChange={(e) => handleStudentInputChange(e, index)}
                            onSelect={(selectedStudentName) => handleStudentSelect(selectedStudentName, index)}
                            allSuggestions={allStudents}
                            placeholder="Nombre del alumno"
                        />
                    </div>
                ));

                return (
                    <div className="fixed inset-0 z-50 overflow-y-auto bg-gray-600 bg-opacity-50 flex items-center justify-center p-4">
                        <div className="bg-white rounded-lg shadow-xl p-6 w-full max-w-md">
                            <h3 className="text-lg font-medium leading-6 text-gray-900 mb-4">Añadir Nueva Clase</h3>
                            <form onSubmit={(e) => { e.preventDefault(); addClass(); }}>
                                <div className="space-y-4">
                                    <div>
                                        <label htmlFor="date" className="block text-sm font-medium text-gray-700">Fecha</label>
                                        <input type="date" name="date" id="date" value={newClass.date} onChange={onNewClassChange} className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" required />
                                    </div>
                                    <div>
                                        <label htmlFor="time" className="block text-sm font-medium text-gray-700">Hora</label>
                                        <input type="time" name="time" id="time" value={newClass.time} onChange={onNewClassChange} className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" required />
                                    </div>
                                    <div>
                                        <label htmlFor="studentsCount" className="block text-sm font-medium text-gray-700">Número de Alumnos</label>
                                        <select name="studentsCount" id="studentsCount" value={newClass.students.length} onChange={onNewClassChange} className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                            <option value="">Seleccionar</option>
                                            <option value="1">1</option>
                                            <option value="2">2</option>
                                            <option value="3">3</option>
                                            <option value="4">4</option>
                                        </select>
                                    </div>
                                    {studentInputs}
                                    <div>
                                        <label htmlFor="pricePerStudent" className="block text-sm font-medium text-gray-700">Precio por Alumno (€)</label>
                                        <input type="number" name="pricePerStudent" id="pricePerStudent" value={newClass.pricePerStudent} onChange={onNewClassChange} className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" step="0.01" required />
                                    </div>
                                </div>
                                <div className="mt-5 sm:mt-6 sm:grid sm:grid-cols-2 sm:gap-3 sm:grid-flow-row-dense">
                                    <button type="submit" className="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:col-start-2 sm:text-sm">Añadir Clase</button>
                                    <button type="button" onClick={onClose} className="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:col-start-1 sm:text-sm">Cancelar</button>
                                </div>
                            </form>
                        </div>
                    </div>
                );
            };

            const EditClassModal = ({ isOpen, onClose, editingClass, onEditedClassChange, handleEditedStudentChange, handleEditedStudentSelect, handleStudentPaidChange, allStudents, onSave }) => {
                if (!isOpen || !editingClass) return null;

                const studentInputs = editingClass.students.map((student, index) => (
                    <div key={index} className="mb-4">
                        <label htmlFor={`studentName-${index}`} className="block text-sm font-medium text-gray-700">Alumno {index + 1}</label>
                        <div className="flex items-center space-x-2">
                            <AutocompleteInput
                                value={student.name || ''}
                                onChange={(e) => handleEditedStudentChange(e, index)}
                                onSelect={(selectedStudentName) => handleEditedStudentSelect(selectedStudentName, index)}
                                allSuggestions={allStudents}
                                placeholder="Nombre del alumno"
                            />
                            <div className="flex items-center">
                                <input
                                    type="checkbox"
                                    id={`studentPaid-${index}`}
                                    checked={student.paid}
                                    onChange={() => handleStudentPaidChange(index)}
                                    className="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"
                                />
                                <label htmlFor={`studentPaid-${index}`} className="ml-2 text-sm text-gray-700">Pagado</label>
                            </div>
                        </div>
                    </div>
                ));

                return (
                    <div className="fixed inset-0 z-50 overflow-y-auto bg-gray-600 bg-opacity-50 flex items-center justify-center p-4">
                        <div className="bg-white rounded-lg shadow-xl p-6 w-full max-w-md">
                            <h3 className="text-lg font-medium leading-6 text-gray-900 mb-4">Editar Clase</h3>
                            <form onSubmit={(e) => { e.preventDefault(); onSave(); }}>
                                <div className="space-y-4">
                                    <div>
                                        <label htmlFor="date" className="block text-sm font-medium text-gray-700">Fecha</label>
                                        <input type="date" name="date" id="date" value={editingClass.date} onChange={onEditedClassChange} className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" required />
                                    </div>
                                    <div>
                                        <label htmlFor="time" className="block text-sm font-medium text-gray-700">Hora</label>
                                        <input type="time" name="time" id="time" value={editingClass.time} onChange={onEditedClassChange} className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" required />
                                    </div>
                                    {studentInputs}
                                    <div>
                                        <label htmlFor="pricePerStudent" className="block text-sm font-medium text-gray-700">Precio por Alumno (€)</label>
                                        <input type="number" name="pricePerStudent" id="pricePerStudent" value={editingClass.pricePerStudent} onChange={onEditedClassChange} className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" step="0.01" required />
                                    </div>
                                </div>
                                <div className="mt-5 sm:mt-6 sm:grid sm:grid-cols-2 sm:gap-3 sm:grid-flow-row-dense">
                                    <button type="submit" className="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:col-start-2 sm:text-sm">Guardar Cambios</button>
                                    <button type="button" onClick={onClose} className="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:col-start-1 sm:text-sm">Cancelar</button>
                                </div>
                            </form>
                        </div>
                    </div>
                );
            };

            const LoginModal = ({ isOpen, onClose, onLogin, onRegister, onReset }) => {
                if (!isOpen) return null;
                const [email, setEmail] = useState('');
                const [password, setPassword] = useState('');
                return (
                    <div className="fixed inset-0 z-50 overflow-y-auto bg-gray-600 bg-opacity-50 flex items-center justify-center p-4">
                        <div className="bg-white rounded-lg shadow-xl p-6 w-full max-w-md">
                            <h3 className="text-lg font-medium leading-6 text-gray-900 mb-4">Iniciar Sesión</h3>
                            <form onSubmit={(e) => { e.preventDefault(); onLogin(email, password); }}>
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700">Correo electrónico</label>
                                        <input type="email" value={email} onChange={(e) => setEmail(e.target.value)} className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm" required />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700">Contraseña</label>
                                        <input type="password" value={password} onChange={(e) => setPassword(e.target.value)} className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm" required />
                                    </div>
                                </div>
                                <div className="mt-5">
                                    <button type="submit" className="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                        Entrar
                                    </button>
                                </div>
                            </form>
                            <div className="mt-4 text-center">
                                <button onClick={() => { onClose(); onRegister(); }} className="text-sm text-indigo-600 hover:text-indigo-500">
                                    ¿No tienes cuenta? Regístrate
                                </button>
                                <br />
                                <button onClick={() => { onClose(); onReset(); }} className="text-sm text-indigo-600 hover:text-indigo-500">
                                    ¿Olvidaste tu contraseña?
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            const RegisterModal = ({ isOpen, onClose, onRegister }) => {
                if (!isOpen) return null;
                const [email, setEmail] = useState('');
                const [password, setPassword] = useState('');
                return (
                    <div className="fixed inset-0 z-50 overflow-y-auto bg-gray-600 bg-opacity-50 flex items-center justify-center p-4">
                        <div className="bg-white rounded-lg shadow-xl p-6 w-full max-w-md">
                            <h3 className="text-lg font-medium leading-6 text-gray-900 mb-4">Registro</h3>
                            <form onSubmit={(e) => { e.preventDefault(); onRegister(email, password); }}>
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700">Correo electrónico</label>
                                        <input type="email" value={email} onChange={(e) => setEmail(e.target.value)} className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm" required />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700">Contraseña</label>
                                        <input type="password" value={password} onChange={(e) => setPassword(e.target.value)} className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm" required />
                                    </div>
                                </div>
                                <div className="mt-5">
                                    <button type="submit" className="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                        Registrar
                                    </button>
                                </div>
                                <div className="mt-4 text-center">
                                    <button onClick={onClose} className="text-sm text-indigo-600 hover:text-indigo-500">
                                        Ya tengo una cuenta
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                );
            };

            const ResetPasswordModal = ({ isOpen, onClose, onReset }) => {
                if (!isOpen) return null;
                const [email, setEmail] = useState('');
                return (
                    <div className="fixed inset-0 z-50 overflow-y-auto bg-gray-600 bg-opacity-50 flex items-center justify-center p-4">
                        <div className="bg-white rounded-lg shadow-xl p-6 w-full max-w-md">
                            <h3 className="text-lg font-medium leading-6 text-gray-900 mb-4">Restablecer Contraseña</h3>
                            <form onSubmit={(e) => { e.preventDefault(); onReset(email); }}>
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700">Correo electrónico</label>
                                        <input type="email" value={email} onChange={(e) => setEmail(e.target.value)} className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm" required />
                                    </div>
                                </div>
                                <div className="mt-5 sm:mt-6 sm:grid sm:grid-cols-2 sm:gap-3 sm:grid-flow-row-dense">
                                    <button type="submit" className="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:col-start-2 sm:text-sm">Enviar correo</button>
                                    <button type="button" onClick={onClose} className="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:col-start-1 sm:text-sm">Cancelar</button>
                                </div>
                            </form>
                        </div>
                    </div>
                );
            };

            const AddStudentModal = ({ isOpen, onClose, newStudentName, setNewStudentName, addStudent }) => {
                if (!isOpen) return null;
                return (
                    <div className="fixed inset-0 z-50 overflow-y-auto bg-gray-600 bg-opacity-50 flex items-center justify-center p-4">
                        <div className="bg-white rounded-lg shadow-xl p-6 w-full max-w-md">
                            <h3 className="text-lg font-medium leading-6 text-gray-900 mb-4">Añadir Nuevo Alumno</h3>
                            <form onSubmit={(e) => { e.preventDefault(); addStudent(); }}>
                                <div className="space-y-4">
                                    <div>
                                        <label htmlFor="newStudentName" className="block text-sm font-medium text-gray-700">Nombre del Alumno</label>
                                        <input type="text" name="newStudentName" id="newStudentName" value={newStudentName} onChange={(e) => setNewStudentName(e.target.value)} className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" required />
                                    </div>
                                </div>
                                <div className="mt-5 sm:mt-6 sm:grid sm:grid-cols-2 sm:gap-3 sm:grid-flow-row-dense">
                                    <button type="submit" className="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:col-start-2 sm:text-sm">Añadir Alumno</button>
                                    <button type="button" onClick={onClose} className="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:col-start-1 sm:text-sm">Cancelar</button>
                                </div>
                            </form>
                        </div>
                    </div>
                );
            };

            const EditStudentModal = ({ isOpen, onClose, newStudentName, setNewStudentName, saveEditedStudent }) => {
                if (!isOpen) return null;
                return (
                    <div className="fixed inset-0 z-50 overflow-y-auto bg-gray-600 bg-opacity-50 flex items-center justify-center p-4">
                        <div className="bg-white rounded-lg shadow-xl p-6 w-full max-w-md">
                            <h3 className="text-lg font-medium leading-6 text-gray-900 mb-4">Editar Alumno</h3>
                            <form onSubmit={(e) => { e.preventDefault(); saveEditedStudent(); }}>
                                <div className="space-y-4">
                                    <div>
                                        <label htmlFor="newStudentName" className="block text-sm font-medium text-gray-700">Nombre del Alumno</label>
                                        <input type="text" name="newStudentName" id="newStudentName" value={newStudentName} onChange={(e) => setNewStudentName(e.target.value)} className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" required />
                                    </div>
                                </div>
                                <div className="mt-5 sm:mt-6 sm:grid sm:grid-cols-2 sm:gap-3 sm:grid-flow-row-dense">
                                    <button type="submit" className="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:col-start-2 sm:text-sm">Guardar Cambios</button>
                                    <button type="button" onClick={onClose} className="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:col-start-1 sm:text-sm">Cancelar</button>
                                </div>
                            </form>
                        </div>
                    </div>
                );
            };

            const AddPaymentModal = ({ isOpen, onClose, newPayment, setNewPayment, addPayment }) => {
                if (!isOpen) return null;
                return (
                    <div className="fixed inset-0 z-50 overflow-y-auto bg-gray-600 bg-opacity-50 flex items-center justify-center p-4">
                        <div className="bg-white rounded-lg shadow-xl p-6 w-full max-w-md">
                            <h3 className="text-lg font-medium leading-6 text-gray-900 mb-4">Añadir Nuevo Pago</h3>
                            <form onSubmit={(e) => { e.preventDefault(); addPayment(); }}>
                                <div className="space-y-4">
                                    <div>
                                        <label htmlFor="paymentDate" className="block text-sm font-medium text-gray-700">Fecha</label>
                                        <input type="date" name="date" id="paymentDate" value={newPayment.date} onChange={(e) => setNewPayment(prev => ({ ...prev, date: e.target.value }))} className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm" required />
                                    </div>
                                    <div>
                                        <label htmlFor="paymentAmount" className="block text-sm font-medium text-gray-700">Monto (€)</label>
                                        <input type="number" name="amount" id="paymentAmount" value={newPayment.amount} onChange={(e) => setNewPayment(prev => ({ ...prev, amount: e.target.value }))} className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm" step="0.01" required />
                                    </div>
                                    <div>
                                        <label htmlFor="paymentDescription" className="block text-sm font-medium text-gray-700">Descripción</label>
                                        <input type="text" name="description" id="paymentDescription" value={newPayment.description} onChange={(e) => setNewPayment(prev => ({ ...prev, description: e.target.value }))} className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm" required />
                                    </div>
                                </div>
                                <div className="mt-5 sm:mt-6 sm:grid sm:grid-cols-2 sm:gap-3 sm:grid-flow-row-dense">
                                    <button type="submit" className="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:col-start-2 sm:text-sm">Añadir Pago</button>
                                    <button type="button" onClick={onClose} className="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:col-start-1 sm:text-sm">Cancelar</button>
                                </div>
                            </form>
                        </div>
                    </div>
                );
            };

            const EditPaymentModal = ({ isOpen, onClose, editingPayment, setEditingPayment, saveEditedPayment }) => {
                if (!isOpen) return null;
                return (
                    <div className="fixed inset-0 z-50 overflow-y-auto bg-gray-600 bg-opacity-50 flex items-center justify-center p-4">
                        <div className="bg-white rounded-lg shadow-xl p-6 w-full max-w-md">
                            <h3 className="text-lg font-medium leading-6 text-gray-900 mb-4">Editar Pago</h3>
                            <form onSubmit={(e) => { e.preventDefault(); saveEditedPayment(); }}>
                                <div className="space-y-4">
                                    <div>
                                        <label htmlFor="paymentDate" className="block text-sm font-medium text-gray-700">Fecha</label>
                                        <input type="date" name="date" id="paymentDate" value={editingPayment.date} onChange={(e) => setEditingPayment(prev => ({ ...prev, date: e.target.value }))} className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm" required />
                                    </div>
                                    <div>
                                        <label htmlFor="paymentAmount" className="block text-sm font-medium text-gray-700">Monto (€)</label>
                                        <input type="number" name="amount" id="paymentAmount" value={editingPayment.amount} onChange={(e) => setEditingPayment(prev => ({ ...prev, amount: e.target.value }))} className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm" step="0.01" required />
                                    </div>
                                    <div>
                                        <label htmlFor="paymentDescription" className="block text-sm font-medium text-gray-700">Descripción</label>
                                        <input type="text" name="description" id="paymentDescription" value={editingPayment.description} onChange={(e) => setEditingPayment(prev => ({ ...prev, description: e.target.value }))} className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm" required />
                                    </div>
                                </div>
                                <div className="mt-5 sm:mt-6 sm:grid sm:grid-cols-2 sm:gap-3 sm:grid-flow-row-dense">
                                    <button type="submit" className="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:col-start-2 sm:text-sm">Guardar Cambios</button>
                                    <button type="button" onClick={onClose} className="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:col-start-1 sm:text-sm">Cancelar</button>
                                </div>
                            </form>
                        </div>
                    </div>
                );
            };

            return (
                <div className="min-h-screen bg-gray-100 p-4 sm:p-6 lg:p-8">
                    {!userId && (
                        <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-center">
                            <h2 className="text-xl font-bold text-gray-800 mb-4">Bienvenido a la Gestión de Clases de Padel</h2>
                            <p className="text-gray-600 mb-4">Por favor, inicia sesión para continuar.</p>
                            <button onClick={() => setShowLoginModal(true)} className="px-6 py-3 bg-indigo-600 text-white rounded-md shadow-md hover:bg-indigo-700">Iniciar Sesión</button>
                        </div>
                    )}
                    {userId && (
                        <>
                            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                                <div className="text-right mb-4">
                                    <span className="text-sm text-gray-600 mr-2">Hola, {userEmail}</span>
                                    <button onClick={handleLogout} className="px-4 py-2 bg-red-600 text-white rounded-md shadow-sm text-sm hover:bg-red-700">
                                        Cerrar Sesión
                                    </button>
                                </div>
                                <div className="bg-white shadow overflow-hidden sm:rounded-lg mb-6">
                                    <div className="px-4 py-5 sm:px-6">
                                        <h2 className="text-lg leading-6 font-medium text-gray-900">Resumen Rápido</h2>
                                    </div>
                                    <div className="border-t border-gray-200 px-4 py-5 sm:p-0">
                                        <dl className="sm:divide-y sm:divide-gray-200">
                                            <div className="py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                                <dt className="text-sm font-medium text-gray-500">Clases registradas</dt>
                                                <dd className="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2">{classCounts}</dd>
                                            </div>
                                            <div className="py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                                <dt className="text-sm font-medium text-gray-500">Total de Ingresos (estimado)</dt>
                                                <dd className="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2">
                                                    {formatCurrency(
                                                        Object.values(classes).reduce((sum, c) => sum + (c.students.filter(s => s.paid).length * c.pricePerStudent), 0)
                                                    )}
                                                </dd>
                                            </div>
                                            <div className="py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                                <dt className="text-sm font-medium text-gray-500">Alumnos Registrados</dt>
                                                <dd className="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2">{Object.keys(students).length}</dd>
                                            </div>
                                        </dl>
                                    </div>
                                </div>
                                <div className="bg-white shadow sm:rounded-lg">
                                    <div className="px-4 py-5 sm:px-6">
                                        <h2 className="text-lg leading-6 font-medium text-gray-900">Menú de Opciones</h2>
                                        <div className="mt-4 flex flex-wrap gap-2">
                                            <button onClick={() => setShowAddClassModal(true)} className="flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                                <i className="fas fa-plus mr-2"></i> Añadir Clase
                                            </button>
                                            <button onClick={() => setShowAddStudentModal(true)} className="flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                                <i className="fas fa-user-plus mr-2"></i> Añadir Alumno
                                            </button>
                                            <button onClick={() => setShowAddPaymentModal(true)} className="flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                                                <i className="fas fa-euro-sign mr-2"></i> Añadir Pago
                                            </button>
                                            <button onClick={() => setShowReportsModal(true)} className="flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500">
                                                <i className="fas fa-chart-line mr-2"></i> Informes
                                            </button>
                                            <button onClick={exportData} className="flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-gray-600 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">
                                                <i className="fas fa-file-export mr-2"></i> Exportar
                                            </button>
                                            <label htmlFor="import-file" className="cursor-pointer flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-gray-600 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">
                                                <i className="fas fa-file-import mr-2"></i> Importar
                                            </label>
                                            <input type="file" id="import-file" className="hidden" accept=".json" onChange={importData} />
                                        </div>
                                    </div>
                                </div>
                                <div className="mt-8 bg-white shadow sm:rounded-lg">
                                    <div className="border-b border-gray-200">
                                        <nav className="-mb-px flex space-x-8 px-4 sm:px-6 lg:px-8" aria-label="Tabs">
                                            <button onClick={() => setActiveTab('clases')} className={`${activeTab === 'clases' ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm`}>Clases</button>
                                            <button onClick={() => setActiveTab('alumnos')} className={`${activeTab === 'alumnos' ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm`}>Alumnos</button>
                                            <button onClick={() => setActiveTab('pagos')} className={`${activeTab === 'pagos' ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm`}>Pagos</button>
                                            <button onClick={() => setActiveTab('actividad')} className={`${activeTab === 'actividad' ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm`}>Registro de Actividad</button>
                                        </nav>
                                    </div>
                                    <div className="p-4 sm:p-6 lg:p-8">
                                        {activeTab === 'clases' && (
                                            <>
                                                <h3 className="text-xl font-bold mb-4">Lista de Clases</h3>
                                                <div className="mb-4">
                                                    <input
                                                        type="text"
                                                        placeholder="Buscar por fecha, hora o alumno..."
                                                        value={searchText}
                                                        onChange={(e) => setSearchText(e.target.value)}
                                                        className="w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                                                    />
                                                </div>
                                                {Object.keys(filteredClasses).length > 0 ? (
                                                    <ClassTable classesData={filteredClasses} onDelete={deleteClass} onEdit={editClass} />
                                                ) : (
                                                    <p className="text-center text-gray-500 p-8">No hay clases registradas.</p>
                                                )}
                                            </>
                                        )}
                                        {activeTab === 'alumnos' && (
                                            <>
                                                <h3 className="text-xl font-bold mb-4">Lista de Alumnos</h3>
                                                {Object.keys(students).length > 0 ? (
                                                    <div className="overflow-x-auto">
                                                        <table className="min-w-full divide-y divide-gray-200">
                                                            <thead className="bg-gray-50">
                                                                <tr>
                                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nombre</th>
                                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody className="bg-white divide-y divide-gray-200">
                                                                {Object.entries(students).map(([id, studentData]) => (
                                                                    <tr key={id}>
                                                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{studentData.name}</td>
                                                                        <td className="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                                                            <button onClick={() => editStudent(id, studentData)} className="text-indigo-600 hover:text-indigo-900 mr-2"><i className="fas fa-edit"></i></button>
                                                                            <button onClick={() => deleteStudent(id)} className="text-red-600 hover:text-red-900"><i className="fas fa-trash-alt"></i></button>
                                                                        </td>
                                                                    </tr>
                                                                ))}
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                ) : (
                                                    <p className="text-center text-gray-500 p-8">No hay alumnos registrados.</p>
                                                )}
                                            </>
                                        )}
                                        {activeTab === 'pagos' && (
                                            <>
                                                <h3 className="text-xl font-bold mb-4">Lista de Pagos</h3>
                                                {Object.keys(payments).length > 0 ? (
                                                    <div className="overflow-x-auto">
                                                        <table className="min-w-full divide-y divide-gray-200">
                                                            <thead className="bg-gray-50">
                                                                <tr>
                                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fecha</th>
                                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Monto</th>
                                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Descripción</th>
                                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody className="bg-white divide-y divide-gray-200">
                                                                {Object.entries(payments).map(([id, paymentData]) => (
                                                                    <tr key={id}>
                                                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{paymentData.date}</td>
                                                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{formatCurrency(paymentData.amount)}</td>
                                                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{paymentData.description}</td>
                                                                        <td className="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                                                            <button onClick={() => editPayment(id, paymentData)} className="text-indigo-600 hover:text-indigo-900 mr-2"><i className="fas fa-edit"></i></button>
                                                                            <button onClick={() => deletePayment(id)} className="text-red-600 hover:text-red-900"><i className="fas fa-trash-alt"></i></button>
                                                                        </td>
                                                                    </tr>
                                                                ))}
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                ) : (
                                                    <p className="text-center text-gray-500 p-8">No hay pagos registrados.</p>
                                                )}
                                            </>
                                        )}
                                        {activeTab === 'actividad' && (
                                            <div className="bg-gray-50 p-6 rounded-lg shadow-inner">
                                                <h3 className="text-xl font-bold mb-4">Registro de Actividad</h3>
                                                {activityLogs.length > 0 ? (
                                                    <ul className="space-y-4">
                                                        {activityLogs.map((log, index) => (
                                                            <li key={index} className="bg-white p-4 rounded-lg shadow-sm">
                                                                <div className="flex items-start">
                                                                    <span className="font-bold text-blue-800 uppercase mr-2">{log.action}:</span>
                                                                    <span className="text-gray-700">{log.details}</span>
                                                                </div>
                                                                <span className="text-gray-500 text-xs">{formatDate(log.timestamp)}</span>
                                                            </li>
                                                        ))}
                                                    </ul>
                                                ) : (
                                                    <p className="text-center text-gray-500 p-8 bg-white">No hay actividad reciente.</p>
                                                )}
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                            <AddClassModal
                                isOpen={showAddClassModal}
                                onClose={() => setShowAddClassModal(false)}
                                newClass={newClass}
                                onNewClassChange={handleNewClassChange}
                                handleStudentInputChange={handleStudentInputChange}
                                handleStudentSelect={handleStudentSelect}
                                allStudents={Object.values(students).map(s => s.name)}
                            />
                            <EditClassModal
                                isOpen={showEditClassModal}
                                onClose={() => setShowEditClassModal(false)}
                                editingClass={editingClass}
                                onEditedClassChange={handleEditedClassChange}
                                handleEditedStudentChange={handleEditedStudentChange}
                                handleEditedStudentSelect={handleEditedStudentSelect}
                                handleStudentPaidChange={handleStudentPaidChange}
                                allStudents={Object.values(students).map(s => s.name)}
                                onSave={saveEditedClass}
                            />
                            <LoginModal
                                isOpen={showLoginModal}
                                onClose={() => setShowLoginModal(false)}
                                onLogin={handleLogin}
                                onRegister={() => { setShowRegisterModal(true); }}
                                onReset={() => { setShowResetPasswordModal(true); }}
                            />
                            <RegisterModal
                                isOpen={showRegisterModal}
                                onClose={() => setShowRegisterModal(false)}
                                onRegister={handleRegister}
                            />
                            <ResetPasswordModal
                                isOpen={showResetPasswordModal}
                                onClose={() => setShowResetPasswordModal(false)}
                                onReset={handleResetPassword}
                            />
                            <AddStudentModal
                                isOpen={showAddStudentModal}
                                onClose={() => setShowAddStudentModal(false)}
                                newStudentName={newStudentName}
                                setNewStudentName={setNewStudentName}
                                addStudent={addStudent}
                            />
                            <EditStudentModal
                                isOpen={showEditStudentModal}
                                onClose={() => setShowEditStudentModal(false)}
                                newStudentName={newStudentName}
                                setNewStudentName={setNewStudentName}
                                saveEditedStudent={saveEditedStudent}
                            />
                            <AddPaymentModal
                                isOpen={showAddPaymentModal}
                                onClose={() => setShowAddPaymentModal(false)}
                                newPayment={newPayment}
                                setNewPayment={setNewPayment}
                                addPayment={addPayment}
                            />
                            <EditPaymentModal
                                isOpen={showEditPaymentModal}
                                onClose={() => setShowEditPaymentModal(false)}
                                editingPayment={editingPayment}
                                setEditingPayment={setEditingPayment}
                                saveEditedPayment={saveEditedPayment}
                            />
                            {showReportsModal && (
                                <div className="fixed inset-0 z-50 overflow-y-auto bg-gray-600 bg-opacity-50 flex items-center justify-center p-4">
                                    <div className="bg-white rounded-lg shadow-xl p-6 w-full max-w-2xl">
                                        <h3 className="text-lg font-medium leading-6 text-gray-900 mb-4">Informes Mensuales</h3>
                                        <div className="space-y-4">
                                            <div>
                                                <label htmlFor="report-date" className="block text-sm font-medium text-gray-700">Selecciona el mes y año</label>
                                                <input type="month" id="report-date" value={reportDate} onChange={(e) => setReportDate(e.target.value)} className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm" />
                                            </div>
                                            <button onClick={generateReport} className="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-purple-600 text-base font-medium text-white hover:bg-purple-700">Generar Informe</button>
                                        </div>
                                        {report && (
                                            <div className="mt-6 p-4 border border-gray-200 rounded-md bg-gray-50">
                                                <h4 className="text-md font-bold text-gray-900 mb-2">Informe de {report.month}</h4>
                                                <p><strong>Clases dadas:</strong> {report.classesCount}</p>
                                                <p><strong>Alumnos totales:</strong> {report.totalStudents}</p>
                                                <p><strong>Ingresos estimados:</strong> {formatCurrency(report.totalRevenue)}</p>
                                                <p><strong>Pagos registrados:</strong> {formatCurrency(report.totalPayments)}</p>
                                                <div className="mt-4 flex space-x-2">
                                                    <button onClick={printReport} className="px-4 py-2 bg-gray-200 text-gray-700 rounded-md shadow-sm text-sm hover:bg-gray-300"><i className="fas fa-print mr-1"></i> Imprimir</button>
                                                </div>
                                            </div>
                                        )}
                                        <div className="mt-5 sm:mt-6">
                                            <button type="button" onClick={() => setShowReportsModal(false)} className="w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50">Cerrar</button>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </>
                    )}
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>


