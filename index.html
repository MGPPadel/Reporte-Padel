<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Informe de Clases de Padel</title>

    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged, createUserWithEmailAndPassword, sendPasswordResetEmail, browserSessionPersistence, setPersistence, browserLocalPersistence } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs, doc, deleteDoc, setDoc, query, onSnapshot, writeBatch, Timestamp, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
import React, { useState, useEffect, useRef, useMemo } from 'react';
import ReactDOM from 'react-dom/client';

// NOTE: It is assumed that this code is run within a canvas environment that provides these global variables.
const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

const db = initializeApp(firebaseConfig);
const firestore = getFirestore(db);
const auth = getAuth(db);

// Utility function to get the user ID, falling back to a random UUID for unauthenticated users
const getUserId = () => {
    return auth.currentUser?.uid || (typeof crypto !== 'undefined' ? crypto.randomUUID() : 'anonymous');
};

const daysOfWeek = ["Domingo", "Lunes", "Martes", "Miércoles", "Jueves", "Viernes", "Sábado"];
const defaultClassPrices = {
    1: 5000,
    2: 3000,
    3: 2500,
    4: 2000,
};
const peopleOptions = [1, 2, 3, 4];
const timesOfDay = [
    '8:00 a. m.', '9:00 a. m.', '10:00 a. m.', '11:00 a. m.', '12:00 p. m.',
    '1:00 p. m.', '2:00 p. m.', '3:00 p. m.', '4:00 p. m.', '5:00 p. m.',
    '6:00 p. m.', '7:00 p. m.', '8:00 p. m.', '9:00 p. m.', '10:00 p. m.',
];
const colorMap = {
    1: 'bg-yellow-100',
    2: 'bg-green-100',
    3: 'bg-blue-100',
    4: 'bg-purple-100',
};

const MessageBox = ({ show, title, content, type, onConfirm, onClose }) => {
    if (!show) return null;
    let icon, bgColor, titleColor;
    switch (type) {
        case 'success':
            icon = <i className="fas fa-check-circle text-4xl text-green-600"></i>;
            bgColor = 'bg-white';
            titleColor = 'text-green-600';
            break;
        case 'error':
            icon = <i className="fas fa-times-circle text-4xl text-red-500"></i>;
            bgColor = 'bg-white';
            titleColor = 'text-red-600';
            break;
        case 'confirm':
            icon = <i className="fas fa-question-circle text-4xl text-blue-800"></i>;
            bgColor = 'bg-white';
            titleColor = 'text-blue-800';
            break;
        default:
            icon = null;
    }

    return (
        <div className="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center z-50">
            <div className={`p-6 rounded-xl shadow-xl w-full max-w-sm text-center ${bgColor} transform transition-all duration-300 ease-in-out scale-100`}>
                <div className="mb-4">{icon}</div>
                <h3 className={`text-lg font-bold mb-2 ${titleColor}`}>{title}</h3>
                <p className="text-sm text-gray-500 mb-4">{content}</p>
                <div className="mt-4">
                    {type === 'confirm' && (
                        <button
                            onClick={onConfirm}
                            className={`py-2 px-4 rounded-lg font-bold transition-colors text-white bg-blue-800 hover:bg-blue-900 shadow-md mr-2`}
                        >
                            Aceptar
                        </button>
                    )}
                    <button
                        onClick={onClose}
                        className={`py-2 px-4 rounded-lg font-bold transition-colors text-white ${type === 'confirm' ? 'bg-gray-400 hover:bg-gray-500' : type === 'success' ? 'bg-blue-600 hover:bg-blue-700' : 'bg-red-500 hover:bg-red-600'} shadow-md`}
                    >
                        {type === 'confirm' ? 'Cancelar' : 'Cerrar'}
                    </button>
                </div>
            </div>
        </div>
    );
};

const AutocompleteStudentInput = ({ index, value, newEntry, setNewEntry, students }) => {
    const [activeIndex, setActiveIndex] = useState(-1);
    const [open, setOpen] = useState(false);
    const containerRef = useRef(null);

    const filteredStudents = useMemo(() => {
        const term = (newEntry.studentNames[index] || "").toLowerCase();
        if (!term) return [];
        return students
            .filter(stu => (`${stu.firstName} ${stu.lastName}`).toLowerCase().includes(term))
            .slice(0, 5);
    }, [students, newEntry.studentNames, index]);

    useEffect(() => {
        const handleClickOutside = (e) => {
            if (containerRef.current && !containerRef.current.contains(e.target)) {
                setOpen(false);
                setActiveIndex(-1);
            }
        };
        document.addEventListener("mousedown", handleClickOutside);
        return () => document.removeEventListener("mousedown", handleClickOutside);
    }, []);

    const handleKeyDown = (e) => {
        if (!open || filteredStudents.length === 0) return;
        if (e.key === "ArrowDown") {
            e.preventDefault();
            setActiveIndex((prev) => (prev + 1) % filteredStudents.length);
        } else if (e.key === "ArrowUp") {
            e.preventDefault();
            setActiveIndex((prev) => (prev <= 0 ? filteredStudents.length - 1 : prev - 1));
        } else if (e.key === "Enter" && activeIndex >= 0) {
            e.preventDefault();
            const stu = filteredStudents[activeIndex];
            handleSelect(stu);
        }
    };

    const handleSelect = (stu) => {
        const newNames = [...newEntry.studentNames];
        newNames[index] = `${stu.firstName} ${stu.lastName}`;
        const newIds = [...(newEntry.studentIds || [])];
        newIds[index] = stu.id;
        setNewEntry((prev) => ({ ...prev, studentNames: newNames, studentIds: newIds }));
        setActiveIndex(-1);
        setOpen(false);
    };

    return (
        <div className="relative mb-2" ref={containerRef}>
            <input
                type="text"
                placeholder={`Alumno ${index + 1}`}
                value={newEntry.studentNames[index] || ""}
                onChange={(e) => {
                    const val = e.target.value;
                    const newNames = [...newEntry.studentNames];
                    newNames[index] = val;
                    setNewEntry((prev) => ({ ...prev, studentNames: newNames }));
                    setActiveIndex(-1);
                    setOpen(true);
                }}
                onFocus={() => setOpen(true)}
                onKeyDown={handleKeyDown}
                className="peer p-3 w-full border rounded-lg focus:ring-2 focus:ring-blue-500 transition-shadow"
            />
            {open && newEntry.studentNames[index] && filteredStudents.length > 0 && (
                <div
                    className="absolute left-0 right-0 mt-1 bg-white border rounded-lg shadow-lg max-h-40 overflow-y-auto z-50
                     opacity-0 translate-y-1 scale-95 pointer-events-none
                     transition-all duration-200 ease-out
                     peer-focus:opacity-100 peer-focus:translate-y-0 peer-focus:scale-100 peer-focus:pointer-events-auto"
                >
                    {filteredStudents.map((stu, i) => (
                        <div
                            key={stu.id}
                            onMouseDown={(e) => { e.preventDefault(); handleSelect(stu); }}
                            onTouchStart={(e) => { e.preventDefault(); handleSelect(stu); }}
                            className={`px-3 py-2 cursor-pointer transition-colors ${i === activeIndex ? "bg-blue-100 text-blue-800 font-semibold" : "hover:bg-gray-100"}`}
                        >
                            {stu.firstName} {stu.lastName}
                        </div>
                    ))}
                </div>
            )}
        </div>
    );
};

const App = () => {
    const [email, setEmail] = useState('');
    const [password, setPassword] = useState('');
    const [userId, setUserId] = useState(null);
    const [userEmail, setUserEmail] = useState('');
    const [loading, setLoading] = useState(true);
    const [classes, setClasses] = useState([]);
    const [students, setStudents] = useState([]);
    const [payments, setPayments] = useState([]);
    const [activityLog, setActivityLog] = useState([]);
    const [customPrices, setCustomPrices] = useState(defaultClassPrices);
    const [currentPage, setCurrentPage] = useState(1);
    const [classesPerPage, setClassesPerPage] = useState(10);
    const [newEntry, setNewEntry] = useState({
        studentCount: 1,
        studentNames: [''],
        studentIds: [''],
        date: new Date().toISOString().split('T')[0],
        day: daysOfWeek[new Date().getDay()],
        time: timesOfDay[0],
        price: defaultClassPrices[1] || 0,
    });
    const [newStudent, setNewStudent] = useState({
        firstName: '',
        lastName: '',
        phone: '',
        description: '',
        status: 'Activo',
        schedule: [],
    });
    const [replaceData, setReplaceData] = useState({ classId: null, studentIndex: null });
    const [isEditingStudent, setIsEditingStudent] = useState(false);
    const [editedStudentId, setEditedStudentId] = useState(null);
    const [filterStatus, setFilterStatus] = useState('Todos');
    const [studentSearch, setStudentSearch] = useState('');
    const filteredStudentsList = useMemo(() => {
        const term = (studentSearch || '').toLowerCase();
        return students.filter(s => {
            const status = s.status || 'Activo';
            const matchesStatus = filterStatus === 'Todos' || status === filterStatus;
            const haystack = `${s.firstName || ''} ${s.lastName || ''} ${s.phone || ''} ${s.description || ''}`.toLowerCase();
            const matchesSearch = !term || haystack.includes(term);
            return matchesStatus && matchesSearch;
        });
    }, [students, studentSearch, filterStatus]);
    const [newPayment, setNewPayment] = useState({
        date: new Date().toISOString().split('T')[0],
        amount: 0,
        description: '',
    });
    const [isEditingPayment, setIsEditingPayment] = useState(false);
    const [editedPaymentId, setEditedPaymentId] = useState(null);
    const [monthlyReports, setMonthlyReports] = useState({});
    const [annualPaymentsReport, setAnnualPaymentsReport] = useState({});
    const [selectedMonthYear, setSelectedMonthYear] = useState('');
    const [isEditing, setIsEditing] = useState(false);
    const [editedClassId, setEditedClassId] = useState(null);
    const [showConfigModal, setShowConfigModal] = useState(false);
    const [view, setView] = useState('list');
    const [filterText, setFilterText] = useState('');
    const [isSigningUp, setIsSigningUp] = useState(false);
    const [messageBox, setMessageBox] = useState({
        show: false,
        title: '',
        content: '',
        type: 'confirm',
        onConfirm: null,
    });

    const reportTableRef = useRef(null);
    const annualPaymentsReportRef = useRef(null);

    const formatPrice = (price) => new Intl.NumberFormat('es-AR', { style: 'currency', currency: 'ARS', minimumFractionDigits: 0 }).format(price);
    const formatMonthYear = (monthYearString) => {
        const [year, month] = monthYearString.split('-');
        return new Date(year, month - 1).toLocaleString('es-AR', { month: 'long', year: 'numeric' });
    };
    const formatDate = (timestamp) => {
        const date = new Date(timestamp.seconds * 1000);
        return date.toLocaleString('es-AR', { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' });
    };

    const handleClassesChange = (snapshot) => {
        const classesData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        setClasses(classesData);
    };

    const handleStudentsChange = (snapshot) => {
        const studentsData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        setStudents(studentsData);
    };

    const handlePaymentsChange = (snapshot) => {
        const paymentsData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        setPayments(paymentsData);
    };

    const handleActivityLogChange = (snapshot) => {
        const logData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        setActivityLog(logData.sort((a, b) => b.timestamp - a.timestamp));
    };

    const fetchCustomPrices = async () => {
        if (!userId) return;
        const pricesRef = doc(firestore, 'artifacts', appId, 'users', userId, 'config', 'prices');
        try {
            const docSnap = await getDoc(pricesRef);
            if (docSnap.exists()) {
                setCustomPrices(docSnap.data().prices);
            }
        } catch (e) {
            console.error("Error fetching custom prices:", e);
        }
    };

    const initializeFirebase = async () => {
        try {
            if (initialAuthToken) {
                await signInWithCustomToken(auth, initialAuthToken);
            } else {
                await signInAnonymously(auth);
            }
            setLoading(false);
        } catch (error) {
            console.error("Error initializing Firebase:", error);
            setMessageBox({
                show: true,
                title: 'Error de configuración',
                content: 'Error al inicializar Firebase. Revisa tu configuración.',
                type: 'error',
                onClose: () => setMessageBox({ ...messageBox, show: false })
            });
            setLoading(false);
        }
    };

    useEffect(() => {
        initializeFirebase();
    }, []);

    useEffect(() => {
        if (userId) {
            const classesRef = collection(firestore, 'artifacts', appId, 'users', userId, 'classes');
            const studentsRef = collection(firestore, 'artifacts', appId, 'users', userId, 'students');
            const paymentsRef = collection(firestore, 'artifacts', appId, 'users', userId, 'payments');
            const activityLogRef = collection(firestore, 'artifacts', appId, 'users', userId, 'activityLog');

            const unsubscribeClasses = onSnapshot(classesRef, handleClassesChange);
            const unsubscribeStudents = onSnapshot(studentsRef, handleStudentsChange);
            const unsubscribePayments = onSnapshot(paymentsRef, handlePaymentsChange);
            const unsubscribeActivityLog = onSnapshot(activityLogRef, handleActivityLogChange);

            fetchCustomPrices();

            return () => {
                unsubscribeClasses();
                unsubscribeStudents();
                unsubscribePayments();
                unsubscribeActivityLog();
            };
        }
    }, [userId]);

    const signIn = async () => {
        try {
            setLoading(true);
            await setPersistence(auth, browserLocalPersistence);
            await signInWithEmailAndPassword(auth, email, password);
            setMessageBox({ show: true, title: 'Inicio de Sesión Exitoso', content: 'La sesión se mantendrá iniciada en este dispositivo.', type: 'success', onClose: () => setMessageBox({ ...messageBox, show: false }) });
        } catch (error) {
            setMessageBox({ show: true, title: 'Error de autenticación', content: 'Usuario o contraseña incorrectos. Por favor, inténtalo de nuevo.', type: 'error', onClose: () => setMessageBox({ ...messageBox, show: false }) });
            console.error("Error signing in:", error);
        } finally {
            setLoading(false);
        }
    };

    const signUp = async () => {
        try {
            setLoading(true);
            await createUserWithEmailAndPassword(auth, email, password);
            setMessageBox({ show: true, title: 'Cuenta creada', content: 'Tu cuenta se ha creado exitosamente. ¡Ya puedes iniciar sesión!', type: 'success', onClose: () => { setMessageBox({ ...messageBox, show: false }); setIsSigningUp(false); } });
        } catch (error) {
            setMessageBox({ show: true, title: 'Error de registro', content: 'Hubo un error al crear la cuenta. Puede que el email ya esté en uso o la contraseña sea demasiado débil.', type: 'error', onClose: () => setMessageBox({ ...messageBox, show: false }) });
            console.error("Error signing up:", error);
        } finally {
            setLoading(false);
        }
    };

    const handlePasswordReset = async () => {
        if (!email) {
            setMessageBox({ show: true, title: 'Error de validación', content: 'Por favor, ingresa tu email para restablecer la contraseña.', type: 'error', onClose: () => setMessageBox({ ...messageBox, show: false }) });
            return;
        }
        try {
            setLoading(true);
            await sendPasswordResetEmail(auth, email);
            setMessageBox({ show: true, title: 'Correo enviado', content: 'Se ha enviado un correo para restablecer tu contraseña. Revisa tu bandeja de entrada.', type: 'success', onClose: () => setMessageBox({ ...messageBox, show: false }) });
        } catch (error) {
            setMessageBox({ show: true, title: 'Error al enviar correo', content: 'Hubo un error al enviar el correo. Asegúrate de que el email sea correcto.', type: 'error', onClose: () => setMessageBox({ ...messageBox, show: false }) });
            console.error("Error sending password reset email:", error);
        } finally {
            setLoading(false);
        }
    };

    const signOutUser = async () => {
        try {
            await signOut(auth);
            setMessageBox({ show: true, title: 'Sesión Cerrada', content: 'Has cerrado sesión exitosamente.', type: 'success', onClose: () => setMessageBox({ ...messageBox, show: false }) });
        } catch (error) {
            setMessageBox({ show: true, title: 'Error al cerrar sesión', content: 'Hubo un problema al cerrar sesión. Inténtalo de nuevo.', type: 'error', onClose: () => setMessageBox({ ...messageBox, show: false }) });
            console.error("Error signing out:", error);
        }
    };

    const addClass = async () => {
        if (!userId) {
            setMessageBox({ show: true, title: 'Error', content: 'Debes iniciar sesión para agregar una clase.', type: 'error', onClose: () => setMessageBox({ ...messageBox, show: false }) });
            return;
        }
        if (newEntry.studentNames.some(name => !name)) {
            setMessageBox({ show: true, title: 'Datos Incompletos', content: 'Por favor, completa todos los nombres de los alumnos.', type: 'error', onClose: () => setMessageBox({ ...messageBox, show: false }) });
            return;
        }
        setLoading(true);
        try {
            const classesRef = collection(firestore, 'artifacts', appId, 'users', userId, 'classes');
            const logRef = collection(firestore, 'artifacts', appId, 'users', userId, 'activityLog');
            const batch = writeBatch(firestore);

            const newClass = {
                ...newEntry,
                date: new Date(newEntry.date),
                timestamp: Timestamp.now(),
            };
            const docRef = doc(classesRef);
            batch.set(docRef, newClass);

            const logEntry = {
                action: 'Clase Agregada',
                details: `Se ha agregado una clase para ${newEntry.day}, ${newEntry.date}.`,
                timestamp: Timestamp.now(),
            };
            batch.set(doc(logRef), logEntry);

            await batch.commit();

            setNewEntry({
                studentCount: 1,
                studentNames: [''],
                studentIds: [''],
                date: new Date().toISOString().split('T')[0],
                day: daysOfWeek[new Date().getDay()],
                time: timesOfDay[0],
                price: customPrices[1] || 0,
            });
            setMessageBox({ show: true, title: 'Clase Agregada', content: 'La clase se ha agregado exitosamente.', type: 'success', onClose: () => setMessageBox({ ...messageBox, show: false }) });
        } catch (e) {
            setMessageBox({ show: true, title: 'Error', content: 'Hubo un error al agregar la clase. Inténtalo de nuevo.', type: 'error', onClose: () => setMessageBox({ ...messageBox, show: false }) });
            console.error("Error adding document: ", e);
        } finally {
            setLoading(false);
        }
    };

    const editClass = (classData) => {
        setIsEditing(true);
        setEditedClassId(classData.id);
        const formattedDate = classData.date.toDate().toISOString().split('T')[0];
        setNewEntry({
            studentCount: classData.studentCount,
            studentNames: classData.studentNames,
            studentIds: classData.studentIds || [],
            date: formattedDate,
            day: classData.day,
            time: classData.time,
            price: classData.price,
        });
        setView('add');
    };

    const updateClass = async () => {
        if (!userId) return;
        setLoading(true);
        try {
            const classDocRef = doc(firestore, 'artifacts', appId, 'users', userId, 'classes', editedClassId);
            const logRef = collection(firestore, 'artifacts', appId, 'users', userId, 'activityLog');
            const batch = writeBatch(firestore);

            const updatedClass = {
                ...newEntry,
                date: new Date(newEntry.date),
                updatedAt: Timestamp.now(),
            };
            batch.update(classDocRef, updatedClass);

            const logEntry = {
                action: 'Clase Actualizada',
                details: `Se ha actualizado la clase para ${newEntry.day}, ${newEntry.date}.`,
                timestamp: Timestamp.now(),
            };
            batch.set(doc(logRef), logEntry);

            await batch.commit();
            setIsEditing(false);
            setEditedClassId(null);
            setNewEntry({
                studentCount: 1,
                studentNames: [''],
                studentIds: [''],
                date: new Date().toISOString().split('T')[0],
                day: daysOfWeek[new Date().getDay()],
                time: timesOfDay[0],
                price: customPrices[1] || 0,
            });
            setView('list');
            setMessageBox({ show: true, title: 'Clase Actualizada', content: 'La clase se ha actualizado exitosamente.', type: 'success', onClose: () => setMessageBox({ ...messageBox, show: false }) });
        } catch (e) {
            setMessageBox({ show: true, title: 'Error', content: 'Hubo un error al actualizar la clase. Inténtalo de nuevo.', type: 'error', onClose: () => setMessageBox({ ...messageBox, show: false }) });
            console.error("Error updating document: ", e);
        } finally {
            setLoading(false);
        }
    };

    const deleteClass = (id) => {
        setMessageBox({
            show: true,
            title: 'Confirmar Eliminación',
            content: '¿Estás seguro de que quieres eliminar esta clase?',
            type: 'confirm',
            onConfirm: async () => {
                setLoading(true);
                try {
                    const classDocRef = doc(firestore, 'artifacts', appId, 'users', userId, 'classes', id);
                    const logRef = collection(firestore, 'artifacts', appId, 'users', userId, 'activityLog');
                    const batch = writeBatch(firestore);

                    batch.delete(classDocRef);
                    const logEntry = {
                        action: 'Clase Eliminada',
                        details: `Se ha eliminado la clase con ID: ${id}.`,
                        timestamp: Timestamp.now(),
                    };
                    batch.set(doc(logRef), logEntry);
                    await batch.commit();

                    setMessageBox({ show: true, title: 'Clase Eliminada', content: 'La clase se ha eliminado exitosamente.', type: 'success', onClose: () => setMessageBox({ ...messageBox, show: false }) });
                } catch (e) {
                    setMessageBox({ show: true, title: 'Error', content: 'Hubo un error al eliminar la clase. Inténtalo de nuevo.', type: 'error', onClose: () => setMessageBox({ ...messageBox, show: false }) });
                    console.error("Error deleting document: ", e);
                } finally {
                    setLoading(false);
                }
            },
            onClose: () => setMessageBox({ ...messageBox, show: false })
        });
    };

    const addStudent = async () => {
        if (!userId) return;
        if (!newStudent.firstName || !newStudent.lastName) {
            setMessageBox({ show: true, title: 'Datos Incompletos', content: 'El nombre y apellido del alumno son obligatorios.', type: 'error', onClose: () => setMessageBox({ ...messageBox, show: false }) });
            return;
        }
        setLoading(true);
        try {
            const studentsRef = collection(firestore, 'artifacts', appId, 'users', userId, 'students');
            const logRef = collection(firestore, 'artifacts', appId, 'users', userId, 'activityLog');
            const batch = writeBatch(firestore);

            const studentToAdd = {
                ...newStudent,
                createdAt: Timestamp.now(),
            };
            const docRef = doc(studentsRef);
            batch.set(docRef, studentToAdd);

            const logEntry = {
                action: 'Alumno Agregado',
                details: `Se ha agregado un nuevo alumno: ${newStudent.firstName} ${newStudent.lastName}.`,
                timestamp: Timestamp.now(),
            };
            batch.set(doc(logRef), logEntry);
            await batch.commit();

            setNewStudent({ firstName: '', lastName: '', phone: '', description: '', status: 'Activo', schedule: [] });
            setMessageBox({ show: true, title: 'Alumno Agregado', content: 'El alumno se ha agregado exitosamente.', type: 'success', onClose: () => setMessageBox({ ...messageBox, show: false }) });
        } catch (e) {
            setMessageBox({ show: true, title: 'Error', content: 'Hubo un error al agregar el alumno. Inténtalo de nuevo.', type: 'error', onClose: () => setMessageBox({ ...messageBox, show: false }) });
            console.error("Error adding student: ", e);
        } finally {
            setLoading(false);
        }
    };

    const editStudent = (studentData) => {
        setIsEditingStudent(true);
        setEditedStudentId(studentData.id);
        setNewStudent(studentData);
        setView('students');
    };

    const updateStudent = async () => {
        if (!userId) return;
        setLoading(true);
        try {
            const studentDocRef = doc(firestore, 'artifacts', appId, 'users', userId, 'students', editedStudentId);
            const logRef = collection(firestore, 'artifacts', appId, 'users', userId, 'activityLog');
            const batch = writeBatch(firestore);

            const updatedStudent = {
                ...newStudent,
                updatedAt: Timestamp.now(),
            };
            batch.update(studentDocRef, updatedStudent);

            const logEntry = {
                action: 'Alumno Actualizado',
                details: `Se ha actualizado la información del alumno: ${newStudent.firstName} ${newStudent.lastName}.`,
                timestamp: Timestamp.now(),
            };
            batch.set(doc(logRef), logEntry);
            await batch.commit();

            setIsEditingStudent(false);
            setEditedStudentId(null);
            setNewStudent({ firstName: '', lastName: '', phone: '', description: '', status: 'Activo', schedule: [] });
            setMessageBox({ show: true, title: 'Alumno Actualizado', content: 'La información del alumno se ha actualizado exitosamente.', type: 'success', onClose: () => setMessageBox({ ...messageBox, show: false }) });
        } catch (e) {
            setMessageBox({ show: true, title: 'Error', content: 'Hubo un error al actualizar el alumno. Inténtalo de nuevo.', type: 'error', onClose: () => setMessageBox({ ...messageBox, show: false }) });
            console.error("Error updating student: ", e);
        } finally {
            setLoading(false);
        }
    };

    const deleteStudent = (id) => {
        setMessageBox({
            show: true,
            title: 'Confirmar Eliminación',
            content: '¿Estás seguro de que quieres eliminar a este alumno? Esto no se puede deshacer.',
            type: 'confirm',
            onConfirm: async () => {
                setLoading(true);
                try {
                    const studentDocRef = doc(firestore, 'artifacts', appId, 'users', userId, 'students', id);
                    const logRef = collection(firestore, 'artifacts', appId, 'users', userId, 'activityLog');
                    const batch = writeBatch(firestore);

                    batch.delete(studentDocRef);

                    const logEntry = {
                        action: 'Alumno Eliminado',
                        details: `Se ha eliminado el alumno con ID: ${id}.`,
                        timestamp: Timestamp.now(),
                    };
                    batch.set(doc(logRef), logEntry);
                    await batch.commit();

                    setMessageBox({ show: true, title: 'Alumno Eliminado', content: 'El alumno se ha eliminado exitosamente.', type: 'success', onClose: () => setMessageBox({ ...messageBox, show: false }) });
                } catch (e) {
                    setMessageBox({ show: true, title: 'Error', content: 'Hubo un error al eliminar el alumno. Inténtalo de nuevo.', type: 'error', onClose: () => setMessageBox({ ...messageBox, show: false }) });
                    console.error("Error deleting student: ", e);
                } finally {
                    setLoading(false);
                }
            },
            onClose: () => setMessageBox({ ...messageBox, show: false })
        });
    };

    const addPayment = async () => {
        if (!userId) return;
        setLoading(true);
        try {
            const paymentsRef = collection(firestore, 'artifacts', appId, 'users', userId, 'payments');
            const logRef = collection(firestore, 'artifacts', appId, 'users', userId, 'activityLog');
            const batch = writeBatch(firestore);

            const paymentToAdd = {
                ...newPayment,
                amount: Number(newPayment.amount),
                date: new Date(newPayment.date),
                timestamp: Timestamp.now(),
            };
            const docRef = doc(paymentsRef);
            batch.set(docRef, paymentToAdd);

            const logEntry = {
                action: 'Pago Agregado',
                details: `Se ha agregado un pago de ${formatPrice(Number(newPayment.amount))} el ${newPayment.date}.`,
                timestamp: Timestamp.now(),
            };
            batch.set(doc(logRef), logEntry);
            await batch.commit();

            setNewPayment({ date: new Date().toISOString().split('T')[0], amount: 0, description: '' });
            setMessageBox({ show: true, title: 'Pago Agregado', content: 'El pago se ha agregado exitosamente.', type: 'success', onClose: () => setMessageBox({ ...messageBox, show: false }) });
        } catch (e) {
            setMessageBox({ show: true, title: 'Error', content: 'Hubo un error al agregar el pago. Inténtalo de nuevo.', type: 'error', onClose: () => setMessageBox({ ...messageBox, show: false }) });
            console.error("Error adding payment: ", e);
        } finally {
            setLoading(false);
        }
    };

    const editPayment = (paymentData) => {
        setIsEditingPayment(true);
        setEditedPaymentId(paymentData.id);
        const formattedDate = paymentData.date.toDate().toISOString().split('T')[0];
        setNewPayment({
            date: formattedDate,
            amount: paymentData.amount,
            description: paymentData.description,
        });
        setView('payments');
    };

    const updatePayment = async () => {
        if (!userId) return;
        setLoading(true);
        try {
            const paymentDocRef = doc(firestore, 'artifacts', appId, 'users', userId, 'payments', editedPaymentId);
            const logRef = collection(firestore, 'artifacts', appId, 'users', userId, 'activityLog');
            const batch = writeBatch(firestore);

            const updatedPayment = {
                ...newPayment,
                amount: Number(newPayment.amount),
                date: new Date(newPayment.date),
                updatedAt: Timestamp.now(),
            };
            batch.update(paymentDocRef, updatedPayment);

            const logEntry = {
                action: 'Pago Actualizado',
                details: `Se ha actualizado un pago de ${formatPrice(Number(newPayment.amount))} el ${newPayment.date}.`,
                timestamp: Timestamp.now(),
            };
            batch.set(doc(logRef), logEntry);
            await batch.commit();

            setIsEditingPayment(false);
            setEditedPaymentId(null);
            setNewPayment({ date: new Date().toISOString().split('T')[0], amount: 0, description: '' });
            setMessageBox({ show: true, title: 'Pago Actualizado', content: 'El pago se ha actualizado exitosamente.', type: 'success', onClose: () => setMessageBox({ ...messageBox, show: false }) });
        } catch (e) {
            setMessageBox({ show: true, title: 'Error', content: 'Hubo un error al actualizar el pago. Inténtalo de nuevo.', type: 'error', onClose: () => setMessageBox({ ...messageBox, show: false }) });
            console.error("Error updating payment: ", e);
        } finally {
            setLoading(false);
        }
    };

    const deletePayment = (id) => {
        setMessageBox({
            show: true,
            title: 'Confirmar Eliminación',
            content: '¿Estás seguro de que quieres eliminar este pago?',
            type: 'confirm',
            onConfirm: async () => {
                setLoading(true);
                try {
                    const paymentDocRef = doc(firestore, 'artifacts', appId, 'users', userId, 'payments', id);
                    const logRef = collection(firestore, 'artifacts', appId, 'users', userId, 'activityLog');
                    const batch = writeBatch(firestore);

                    batch.delete(paymentDocRef);
                    const logEntry = {
                        action: 'Pago Eliminado',
                        details: `Se ha eliminado el pago con ID: ${id}.`,
                        timestamp: Timestamp.now(),
                    };
                    batch.set(doc(logRef), logEntry);
                    await batch.commit();

                    setMessageBox({ show: true, title: 'Pago Eliminado', content: 'El pago se ha eliminado exitosamente.', type: 'success', onClose: () => setMessageBox({ ...messageBox, show: false }) });
                } catch (e) {
                    setMessageBox({ show: true, title: 'Error', content: 'Hubo un error al eliminar el pago. Inténtalo de nuevo.', type: 'error', onClose: () => setMessageBox({ ...messageBox, show: false }) });
                    console.error("Error deleting payment: ", e);
                } finally {
                    setLoading(false);
                }
            },
            onClose: () => setMessageBox({ ...messageBox, show: false })
        });
    };

    const generateMonthlyReports = () => {
        const reports = {};
        classes.forEach(cls => {
            const date = cls.date.toDate();
            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const monthYear = `${year}-${month.toString().padStart(2, '0')}`;
            if (!reports[monthYear]) {
                reports[monthYear] = {
                    totalRevenue: 0,
                    totalClasses: 0,
                    classes: [],
                };
            }
            reports[monthYear].totalRevenue += cls.price;
            reports[monthYear].totalClasses += 1;
            reports[monthYear].classes.push(cls);
        });
        setMonthlyReports(reports);
        const lastMonth = Object.keys(reports).sort().pop();
        if (lastMonth) {
            setSelectedMonthYear(lastMonth);
        }
    };

    const generateAnnualPaymentsReport = () => {
        const report = {};
        payments.forEach(payment => {
            const date = payment.date.toDate();
            const year = date.getFullYear();
            const month = date.getMonth();
            const monthName = new Date(date).toLocaleString('es-AR', { month: 'long' });
            if (!report[year]) {
                report[year] = { months: {} };
            }
            if (!report[year].months[month]) {
                report[year].months[month] = {
                    monthName,
                    total: 0,
                    payments: [],
                };
            }
            report[year].months[month].total += payment.amount;
            report[year].months[month].payments.push(payment);
        });
        setAnnualPaymentsReport(report);
    };

    const handleSavePrices = async () => {
        if (!userId) return;
        setLoading(true);
        try {
            const pricesRef = doc(firestore, 'artifacts', appId, 'users', userId, 'config', 'prices');
            await setDoc(pricesRef, { prices: customPrices });
            setShowConfigModal(false);
            setMessageBox({ show: true, title: 'Precios guardados', content: 'Los precios de las clases se han actualizado.', type: 'success', onClose: () => setMessageBox({ ...messageBox, show: false }) });
        } catch (e) {
            setMessageBox({ show: true, title: 'Error', content: 'Hubo un error al guardar los precios.', type: 'error', onClose: () => setMessageBox({ ...messageBox, show: false }) });
            console.error("Error saving prices:", e);
        } finally {
            setLoading(false);
        }
    };

    const calculateStudentReport = (studentId) => {
        const studentClasses = classes.filter(cls => cls.studentIds && cls.studentIds.includes(studentId));
        const totalClasses = studentClasses.length;
        const totalPaid = payments.filter(p => p.description.includes(studentId)).reduce((sum, p) => sum + p.amount, 0);
        const totalDebt = studentClasses.reduce((sum, cls) => sum + cls.price, 0) - totalPaid;
        return { totalClasses, totalDebt };
    };

    const handleGeneratePDF = (tableRef, filename) => {
        if (!tableRef.current) return;

        html2canvas(tableRef.current, { scale: 2 }).then(canvas => {
            const imgData = canvas.toDataURL('image/png');
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'mm', 'a4');
            const imgWidth = 210;
            const pageHeight = 297;
            const imgHeight = (canvas.height * imgWidth) / canvas.width;
            let heightLeft = imgHeight;
            let position = 0;

            doc.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
            heightLeft -= pageHeight;

            while (heightLeft >= 0) {
                position = heightLeft - imgHeight;
                doc.addPage();
                doc.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
            }

            doc.save(filename);
        }).catch(err => {
            console.error("Error generating PDF:", err);
            setMessageBox({ show: true, title: 'Error', content: 'Hubo un error al generar el PDF.', type: 'error', onClose: () => setMessageBox({ ...messageBox, show: false }) });
        });
    };

    const filterClasses = (classes, filterText) => {
        const term = (filterText || '').toLowerCase();
        if (!term) return classes;
        return classes.filter(cls => {
            const studentNames = (cls.studentNames || []).join(' ').toLowerCase();
            return studentNames.includes(term);
        });
    };

    // NOTE: CÓDIGO CORREGIDO PARA MOSTRAR CLASES DE MAÑANA
    const filterClassesForTomorrow = (classes) => {
        const today = new Date();
        // NOTE: Obtener la fecha de mañana.
        const tomorrow = new Date(today);
        tomorrow.setDate(today.getDate() + 1);
        const tomorrowDateString = tomorrow.toISOString().split('T')[0];
        
        // NOTE: Filtrar clases que coincidan con la fecha de mañana.
        // Se asume que la fecha de la clase se guarda en la base de datos como una cadena "YYYY-MM-DD".
        return classes.filter(cls => {
            const classDate = cls.date.toDate().toISOString().split('T')[0];
            return classDate === tomorrowDateString;
        });
    };

    const classesTomorrow = useMemo(() => filterClassesForTomorrow(classes), [classes]);
    const today = new Date();
    const tomorrow = new Date(today);
    tomorrow.setDate(today.getDate() + 1);
    const tomorrowDayName = daysOfWeek[tomorrow.getDay()];
    const tomorrowFormatted = `${tomorrowDayName}, ${tomorrow.getDate()} de ${tomorrow.toLocaleString('es-AR', { month: 'long' })}`;

    const filteredClasses = useMemo(() => filterClasses(classes, filterText), [classes, filterText]);
    const indexOfLastClass = currentPage * classesPerPage;
    const indexOfFirstClass = indexOfLastClass - classesPerPage;
    const currentClasses = filteredClasses.slice(indexOfFirstClass, indexOfLastClass);
    const totalPages = Math.ceil(filteredClasses.length / classesPerPage);
    const paginate = (pageNumber) => setCurrentPage(pageNumber);

    const paginatedPayments = payments.slice((currentPage - 1) * classesPerPage, currentPage * classesPerPage);
    const totalPaymentsPages = Math.ceil(payments.length / classesPerPage);
    const paginatePayments = (pageNumber) => setCurrentPage(pageNumber);

    const paginatedStudents = filteredStudentsList.slice((currentPage - 1) * classesPerPage, currentPage * classesPerPage);
    const totalStudentsPages = Math.ceil(filteredStudentsList.length / classesPerPage);
    const paginateStudents = (pageNumber) => setCurrentPage(pageNumber);

    if (loading) {
        return (
            <div className="flex items-center justify-center min-h-screen bg-gray-100">
                <div className="text-xl font-bold text-gray-700">Cargando...</div>
            </div>
        );
    }

    if (!userId) {
        return (
            <div className="min-h-screen flex items-center justify-center bg-gray-100 p-4">
                <div className="bg-white p-8 rounded-xl shadow-lg w-full max-w-md">
                    <h2 className="text-2xl font-bold text-center mb-6 text-gray-800">{isSigningUp ? 'Crear Cuenta' : 'Iniciar Sesión'}</h2>
                    <div className="mb-4">
                        <label className="block text-gray-700 text-sm font-bold mb-2" htmlFor="email">Email</label>
                        <input
                            id="email"
                            type="email"
                            placeholder="Email"
                            value={email}
                            onChange={(e) => setEmail(e.target.value)}
                            className="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 transition-shadow"
                        />
                    </div>
                    <div className="mb-6">
                        <label className="block text-gray-700 text-sm font-bold mb-2" htmlFor="password">Contraseña</label>
                        <input
                            id="password"
                            type="password"
                            placeholder="Contraseña"
                            value={password}
                            onChange={(e) => setPassword(e.target.value)}
                            className="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 transition-shadow"
                        />
                    </div>
                    <div className="flex items-center justify-between mb-4">
                        <button
                            onClick={isSigningUp ? signUp : signIn}
                            className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg focus:outline-none focus:shadow-outline transition-colors shadow-md"
                        >
                            {isSigningUp ? 'Registrarse' : 'Iniciar Sesión'}
                        </button>
                        <button
                            onClick={() => setIsSigningUp(!isSigningUp)}
                            className="text-blue-600 hover:underline text-sm"
                        >
                            {isSigningUp ? '¿Ya tienes una cuenta?' : '¿No tienes una cuenta?'}
                        </button>
                    </div>
                    {!isSigningUp && (
                        <div className="text-center">
                            <button
                                onClick={handlePasswordReset}
                                className="inline-block align-baseline font-bold text-sm text-blue-600 hover:underline"
                            >
                                ¿Olvidaste tu contraseña?
                            </button>
                        </div>
                    )}
                </div>
                <MessageBox
                    show={messageBox.show}
                    title={messageBox.title}
                    content={messageBox.content}
                    type={messageBox.type}
                    onConfirm={messageBox.onConfirm}
                    onClose={messageBox.onClose}
                />
            </div>
        );
    }

    const renderView = () => {
        switch (view) {
            case 'add':
                return (
                    <div className="bg-white p-6 rounded-xl shadow-lg">
                        <h2 className="text-2xl font-bold mb-6 text-gray-800">{isEditing ? 'Editar Clase' : 'Registrar Clase'}</h2>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div className="flex flex-col">
                                <label htmlFor="class-date" className="block text-sm font-medium text-gray-700 mb-1">Fecha</label>
                                <input
                                    type="date"
                                    id="class-date"
                                    value={newEntry.date}
                                    onChange={(e) => {
                                        const newDate = new Date(e.target.value);
                                        setNewEntry({
                                            ...newEntry,
                                            date: e.target.value,
                                            day: daysOfWeek[newDate.getUTCDay()]
                                        });
                                    }}
                                    className="p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 transition-shadow"
                                />
                            </div>
                            <div className="flex flex-col">
                                <label htmlFor="class-time" className="block text-sm font-medium text-gray-700 mb-1">Hora</label>
                                <select
                                    id="class-time"
                                    value={newEntry.time}
                                    onChange={(e) => setNewEntry({ ...newEntry, time: e.target.value })}
                                    className="p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 transition-shadow"
                                >
                                    {timesOfDay.map((time) => (
                                        <option key={time} value={time}>{time}</option>
                                    ))}
                                </select>
                            </div>
                            <div className="flex flex-col">
                                <label htmlFor="student-count" className="block text-sm font-medium text-gray-700 mb-1">Cantidad de Alumnos</label>
                                <select
                                    id="student-count"
                                    value={newEntry.studentCount}
                                    onChange={(e) => {
                                        const count = parseInt(e.target.value, 10);
                                        const newStudentNames = Array(count).fill('').map((_, i) => newEntry.studentNames[i] || '');
                                        const newStudentIds = Array(count).fill('').map((_, i) => newEntry.studentIds[i] || '');
                                        setNewEntry({
                                            ...newEntry,
                                            studentCount: count,
                                            studentNames: newStudentNames,
                                            studentIds: newStudentIds,
                                            price: customPrices[count] || 0
                                        });
                                    }}
                                    className="p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 transition-shadow"
                                >
                                    {peopleOptions.map(p => <option key={p} value={p}>{p}</option>)}
                                </select>
                            </div>
                            <div className="flex flex-col">
                                <label htmlFor="class-price" className="block text-sm font-medium text-gray-700 mb-1">Precio</label>
                                <input
                                    type="number"
                                    id="class-price"
                                    value={newEntry.price}
                                    onChange={(e) => setNewEntry({ ...newEntry, price: Number(e.target.value) })}
                                    className="p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 transition-shadow"
                                    min="0"
                                />
                            </div>
                        </div>
                        <div className="mt-6">
                            <label className="block text-sm font-medium text-gray-700 mb-2">Nombres de Alumnos</label>
                            {newEntry.studentNames.map((name, index) => (
                                <AutocompleteStudentInput
                                    key={index}
                                    index={index}
                                    value={name}
                                    newEntry={newEntry}
                                    setNewEntry={setNewEntry}
                                    students={students}
                                />
                            ))}
                        </div>
                        <div className="mt-6 flex justify-end space-x-4">
                            <button
                                onClick={() => setView('list')}
                                className="px-6 py-3 bg-gray-400 text-white font-bold rounded-lg shadow-md transition-colors hover:bg-gray-500"
                            >
                                Cancelar
                            </button>
                            <button
                                onClick={isEditing ? updateClass : addClass}
                                className="px-6 py-3 bg-blue-600 text-white font-bold rounded-lg shadow-md transition-colors hover:bg-blue-700"
                            >
                                {isEditing ? 'Guardar Cambios' : 'Registrar Clase'}
                            </button>
                        </div>
                    </div>
                );
            case 'students':
                return (
                    <div className="bg-white p-6 rounded-xl shadow-lg">
                        <h2 className="text-2xl font-bold mb-6 text-gray-800">{isEditingStudent ? 'Editar Alumno' : 'Registrar Alumno'}</h2>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div className="flex flex-col">
                                <label htmlFor="student-firstName" className="block text-sm font-medium text-gray-700 mb-1">Nombre</label>
                                <input
                                    type="text"
                                    id="student-firstName"
                                    value={newStudent.firstName}
                                    onChange={(e) => setNewStudent({ ...newStudent, firstName: e.target.value })}
                                    className="p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 transition-shadow"
                                    placeholder="Nombre"
                                />
                            </div>
                            <div className="flex flex-col">
                                <label htmlFor="student-lastName" className="block text-sm font-medium text-gray-700 mb-1">Apellido</label>
                                <input
                                    type="text"
                                    id="student-lastName"
                                    value={newStudent.lastName}
                                    onChange={(e) => setNewStudent({ ...newStudent, lastName: e.target.value })}
                                    className="p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 transition-shadow"
                                    placeholder="Apellido"
                                />
                            </div>
                            <div className="flex flex-col">
                                <label htmlFor="student-phone" className="block text-sm font-medium text-gray-700 mb-1">Teléfono</label>
                                <input
                                    type="text"
                                    id="student-phone"
                                    value={newStudent.phone}
                                    onChange={(e) => setNewStudent({ ...newStudent, phone: e.target.value })}
                                    className="p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 transition-shadow"
                                    placeholder="Teléfono"
                                />
                            </div>
                            <div className="flex flex-col">
                                <label htmlFor="student-description" className="block text-sm font-medium text-gray-700 mb-1">Descripción</label>
                                <input
                                    type="text"
                                    id="student-description"
                                    value={newStudent.description}
                                    onChange={(e) => setNewStudent({ ...newStudent, description: e.target.value })}
                                    className="p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 transition-shadow"
                                    placeholder="Descripción"
                                />
                            </div>
                        </div>
                        <div className="mt-6 flex justify-end space-x-4">
                            <button
                                onClick={() => {
                                    setView('studentsList');
                                    setIsEditingStudent(false);
                                    setNewStudent({ firstName: '', lastName: '', phone: '', description: '', status: 'Activo', schedule: [] });
                                }}
                                className="px-6 py-3 bg-gray-400 text-white font-bold rounded-lg shadow-md transition-colors hover:bg-gray-500"
                            >
                                Cancelar
                            </button>
                            <button
                                onClick={isEditingStudent ? updateStudent : addStudent}
                                className="px-6 py-3 bg-blue-600 text-white font-bold rounded-lg shadow-md transition-colors hover:bg-blue-700"
                            >
                                {isEditingStudent ? 'Guardar Cambios' : 'Registrar Alumno'}
                            </button>
                        </div>
                    </div>
                );
            case 'studentsList':
                return (
                    <div className="bg-white p-6 rounded-xl shadow-lg">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-2xl font-bold text-gray-800">Alumnos</h2>
                            <button onClick={() => setView('students')} className="px-4 py-2 bg-blue-600 text-white rounded-lg font-bold shadow-md transition-colors hover:bg-blue-700">
                                Agregar Alumno
                            </button>
                        </div>
                        <div className="flex flex-col md:flex-row justify-between mb-4 space-y-4 md:space-y-0 md:space-x-4">
                            <div className="relative w-full md:w-1/2">
                                <i className="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                                <input
                                    type="text"
                                    placeholder="Buscar por nombre o teléfono..."
                                    value={studentSearch}
                                    onChange={(e) => setStudentSearch(e.target.value)}
                                    className="p-3 pl-12 w-full border rounded-lg focus:ring-2 focus:ring-blue-500 transition-shadow"
                                />
                            </div>
                            <div className="w-full md:w-1/2">
                                <select
                                    value={filterStatus}
                                    onChange={(e) => setFilterStatus(e.target.value)}
                                    className="p-3 w-full border rounded-lg focus:ring-2 focus:ring-blue-500 transition-shadow"
                                >
                                    <option value="Todos">Todos</option>
                                    <option value="Activo">Activos</option>
                                    <option value="Inactivo">Inactivos</option>
                                </select>
                            </div>
                        </div>
                        {filteredStudentsList.length > 0 ? (
                            <div className="overflow-x-auto">
                                <table className="min-w-full divide-y divide-gray-200">
                                    <thead className="bg-gray-50">
                                        <tr>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nombre</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Teléfono</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estado</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody className="bg-white divide-y divide-gray-200">
                                        {paginatedStudents.map((student) => (
                                            <tr key={student.id}>
                                                <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{student.firstName} {student.lastName}</td>
                                                <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{student.phone}</td>
                                                <td className="px-6 py-4 whitespace-nowrap">
                                                    <span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${student.status === 'Activo' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>
                                                        {student.status}
                                                    </span>
                                                </td>
                                                <td className="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                    <button onClick={() => editStudent(student)} className="text-blue-600 hover:text-blue-900 mr-2">
                                                        <i className="fas fa-edit"></i>
                                                    </button>
                                                    <button onClick={() => deleteStudent(student.id)} className="text-red-600 hover:text-red-900">
                                                        <i className="fas fa-trash"></i>
                                                    </button>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                                <div className="mt-4 flex justify-between items-center">
                                    <div className="text-sm text-gray-700">Página {currentPage} de {totalStudentsPages}</div>
                                    <div className="flex space-x-2">
                                        <button
                                            onClick={() => paginateStudents(currentPage - 1)}
                                            disabled={currentPage === 1}
                                            className="px-4 py-2 border rounded-lg text-sm font-medium bg-gray-200 hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed"
                                        >
                                            Anterior
                                        </button>
                                        <button
                                            onClick={() => paginateStudents(currentPage + 1)}
                                            disabled={currentPage === totalStudentsPages}
                                            className="px-4 py-2 border rounded-lg text-sm font-medium bg-gray-200 hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed"
                                        >
                                            Siguiente
                                        </button>
                                    </div>
                                </div>
                            </div>
                        ) : (
                            <p className="text-center text-gray-500 p-8 bg-white">No hay alumnos registrados. ¡Comienza a agregar algunos!</p>
                        )}
                    </div>
                );
            case 'payments':
                return (
                    <div className="bg-white p-6 rounded-xl shadow-lg">
                        <h2 className="text-2xl font-bold mb-6 text-gray-800">{isEditingPayment ? 'Editar Pago' : 'Registrar Pago'}</h2>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div className="flex flex-col">
                                <label htmlFor="payment-date" className="block text-sm font-medium text-gray-700 mb-1">Fecha</label>
                                <input
                                    type="date"
                                    id="payment-date"
                                    value={newPayment.date}
                                    onChange={(e) => setNewPayment({ ...newPayment, date: e.target.value })}
                                    className="p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 transition-shadow"
                                />
                            </div>
                            <div className="flex flex-col">
                                <label htmlFor="payment-amount" className="block text-sm font-medium text-gray-700 mb-1">Monto</label>
                                <input
                                    type="number"
                                    id="payment-amount"
                                    value={newPayment.amount}
                                    onChange={(e) => setNewPayment({ ...newPayment, amount: e.target.value })}
                                    className="p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 transition-shadow"
                                    min="0"
                                />
                            </div>
                            <div className="md:col-span-2 flex flex-col">
                                <label htmlFor="payment-description" className="block text-sm font-medium text-gray-700 mb-1">Descripción</label>
                                <input
                                    type="text"
                                    id="payment-description"
                                    value={newPayment.description}
                                    onChange={(e) => setNewPayment({ ...newPayment, description: e.target.value })}
                                    className="p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 transition-shadow"
                                    placeholder="Ej: 'Pago de clase de Juan'"
                                />
                            </div>
                        </div>
                        <div className="mt-6 flex justify-end space-x-4">
                            <button
                                onClick={() => {
                                    setView('paymentsList');
                                    setIsEditingPayment(false);
                                    setNewPayment({ date: new Date().toISOString().split('T')[0], amount: 0, description: '' });
                                }}
                                className="px-6 py-3 bg-gray-400 text-white font-bold rounded-lg shadow-md transition-colors hover:bg-gray-500"
                            >
                                Cancelar
                            </button>
                            <button
                                onClick={isEditingPayment ? updatePayment : addPayment}
                                className="px-6 py-3 bg-blue-600 text-white font-bold rounded-lg shadow-md transition-colors hover:bg-blue-700"
                            >
                                {isEditingPayment ? 'Guardar Cambios' : 'Registrar Pago'}
                            </button>
                        </div>
                    </div>
                );
            case 'paymentsList':
                return (
                    <div className="bg-white p-6 rounded-xl shadow-lg">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-2xl font-bold text-gray-800">Historial de Pagos</h2>
                            <button onClick={() => setView('payments')} className="px-4 py-2 bg-blue-600 text-white rounded-lg font-bold shadow-md transition-colors hover:bg-blue-700">
                                Registrar Pago
                            </button>
                        </div>
                        {payments.length > 0 ? (
                            <div className="overflow-x-auto">
                                <table className="min-w-full divide-y divide-gray-200">
                                    <thead className="bg-gray-50">
                                        <tr>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fecha</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Monto</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Descripción</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody className="bg-white divide-y divide-gray-200">
                                        {paginatedPayments.map((payment) => (
                                            <tr key={payment.id}>
                                                <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{payment.date.toDate().toLocaleDateString('es-AR')}</td>
                                                <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{formatPrice(payment.amount)}</td>
                                                <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{payment.description}</td>
                                                <td className="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                    <button onClick={() => editPayment(payment)} className="text-blue-600 hover:text-blue-900 mr-2">
                                                        <i className="fas fa-edit"></i>
                                                    </button>
                                                    <button onClick={() => deletePayment(payment.id)} className="text-red-600 hover:text-red-900">
                                                        <i className="fas fa-trash"></i>
                                                    </button>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                                <div className="mt-4 flex justify-between items-center">
                                    <div className="text-sm text-gray-700">Página {currentPage} de {totalPaymentsPages}</div>
                                    <div className="flex space-x-2">
                                        <button
                                            onClick={() => paginatePayments(currentPage - 1)}
                                            disabled={currentPage === 1}
                                            className="px-4 py-2 border rounded-lg text-sm font-medium bg-gray-200 hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed"
                                        >
                                            Anterior
                                        </button>
                                        <button
                                            onClick={() => paginatePayments(currentPage + 1)}
                                            disabled={currentPage === totalPaymentsPages}
                                            className="px-4 py-2 border rounded-lg text-sm font-medium bg-gray-200 hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed"
                                        >
                                            Siguiente
                                        </button>
                                    </div>
                                </div>
                            </div>
                        ) : (
                            <p className="text-center text-gray-500 p-8 bg-white">No hay pagos registrados. ¡Comienza a agregar algunos!</p>
                        )}
                    </div>
                );
            case 'reports':
                return (
                    <div className="bg-white p-6 rounded-xl shadow-lg">
                        <div className="flex flex-col md:flex-row justify-between items-center mb-6 space-y-4 md:space-y-0">
                            <h2 className="text-2xl font-bold text-gray-800">Reportes Mensuales</h2>
                            <div className="flex space-x-2">
                                <select
                                    value={selectedMonthYear}
                                    onChange={(e) => setSelectedMonthYear(e.target.value)}
                                    className="p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 transition-shadow"
                                >
                                    {Object.keys(monthlyReports).sort().reverse().map(monthYear => (
                                        <option key={monthYear} value={monthYear}>
                                            {formatMonthYear(monthYear)}
                                        </option>
                                    ))}
                                </select>
                                <button
                                    onClick={() => handleGeneratePDF(reportTableRef, `Reporte-Clases-${selectedMonthYear}.pdf`)}
                                    className="px-4 py-2 bg-red-600 text-white rounded-lg font-bold shadow-md transition-colors hover:bg-red-700"
                                >
                                    Generar PDF
                                </button>
                            </div>
                        </div>
                        {selectedMonthYear && monthlyReports[selectedMonthYear] ? (
                            <div className="space-y-6" ref={reportTableRef}>
                                <div className="p-4 bg-blue-50 rounded-lg shadow-inner">
                                    <h3 className="text-xl font-bold mb-2 text-blue-800 text-center">Resumen de {formatMonthYear(selectedMonthYear)}</h3>
                                    <p className="text-lg font-semibold text-center text-gray-700">Total de clases: {monthlyReports[selectedMonthYear].totalClasses}</p>
                                    <p className="text-lg font-semibold text-center text-gray-700">Ingresos totales: <span className="text-green-600">{formatPrice(monthlyReports[selectedMonthYear].totalRevenue)}</span></p>
                                </div>
                                <div className="overflow-x-auto">
                                    <table className="min-w-full divide-y divide-gray-200">
                                        <thead className="bg-gray-50">
                                            <tr>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fecha</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Día</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Hora</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Alumnos</th>
                                                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Precio</th>
                                            </tr>
                                        </thead>
                                        <tbody className="bg-white divide-y divide-gray-200">
                                            {monthlyReports[selectedMonthYear].classes.map(cls => (
                                                <tr key={cls.id}>
                                                    <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{cls.date.toDate().toLocaleDateString('es-AR')}</td>
                                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{cls.day}</td>
                                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{cls.time}</td>
                                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{cls.studentNames.join(', ')}</td>
                                                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{formatPrice(cls.price)}</td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        ) : (
                            <p className="text-center text-gray-500 p-8">No hay datos para el reporte seleccionado.</p>
                        )}
                    </div>
                );
            case 'annualPaymentsReport':
                const annualYears = Object.keys(annualPaymentsReport).sort().reverse();
                const currentYear = annualYears[0];
                const yearData = annualPaymentsReport[currentYear];
                const monthsInOrder = yearData ? Object.keys(yearData.months).sort((a, b) => parseInt(a) - parseInt(b)) : [];

                return (
                    <div className="bg-white p-6 rounded-xl shadow-lg">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-2xl font-bold text-gray-800">Reporte Anual de Pagos</h2>
                            <button
                                onClick={() => handleGeneratePDF(annualPaymentsReportRef, `Reporte-Pagos-${currentYear}.pdf`)}
                                className="px-4 py-2 bg-red-600 text-white rounded-lg font-bold shadow-md transition-colors hover:bg-red-700"
                            >
                                Generar PDF
                            </button>
                        </div>
                        {currentYear ? (
                            <div className="space-y-6" ref={annualPaymentsReportRef}>
                                <h3 className="text-xl font-bold mb-2 text-blue-800 text-center">Pagos del año {currentYear}</h3>
                                {monthsInOrder.map(month => (
                                    <div key={month} className="p-4 bg-gray-50 rounded-lg shadow-sm">
                                        <h4 className="text-lg font-semibold mb-2">{yearData.months[month].monthName}</h4>
                                        <p className="font-bold text-green-600">Total: {formatPrice(yearData.months[month].total)}</p>
                                    </div>
                                ))}
                            </div>
                        ) : (
                            <p className="text-center text-gray-500 p-8">No hay datos de pagos para generar el reporte.</p>
                        )}
                    </div>
                );
            case 'activityLog':
                return (
                    <div className="bg-white p-6 rounded-xl shadow-lg">
                        <h2 className="text-2xl font-bold mb-6 text-gray-800">Registro de Actividad</h2>
                        {activityLog.length > 0 ? (
                            <ul className="divide-y divide-gray-200">
                                {activityLog.map((log) => (
                                    <li key={log.id} className="py-4">
                                        <p className="text-gray-800">{log.details}</p>
                                        <span className="text-gray-500 text-xs">{formatDate(log.timestamp)}</span>
                                    </li>
                                ))}
                            </ul>
                        ) : (
                            <p className="text-center text-gray-500 p-8 bg-white">No hay actividad reciente.</p>
                        )}
                    </div>
                );
            default: // 'list' view
                const classTotalRevenue = classes.reduce((sum, cls) => sum + cls.price, 0);
                const paymentTotal = payments.reduce((sum, p) => sum + p.amount, 0);
                const balance = paymentTotal - classTotalRevenue;
                const balanceColor = balance >= 0 ? 'text-green-600' : 'text-red-600';

                return (
                    <>
                        <div className="bg-white p-6 rounded-xl shadow-lg mb-6">
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-6 text-center">
                                <div className="p-4 bg-blue-50 rounded-lg shadow-inner">
                                    <h3 className="text-lg font-semibold text-gray-700">Clases Registradas</h3>
                                    <p className="text-3xl font-bold text-blue-600">{classes.length}</p>
                                </div>
                                <div className="p-4 bg-green-50 rounded-lg shadow-inner">
                                    <h3 className="text-lg font-semibold text-gray-700">Ingresos Totales</h3>
                                    <p className="text-3xl font-bold text-green-600">{formatPrice(paymentTotal)}</p>
                                </div>
                                <div className="p-4 bg-yellow-50 rounded-lg shadow-inner">
                                    <h3 className="text-lg font-semibold text-gray-700">Balance</h3>
                                    <p className={`text-3xl font-bold ${balanceColor}`}>{formatPrice(balance)}</p>
                                </div>
                            </div>
                        </div>

                        <div className="bg-white p-6 rounded-xl shadow-lg mb-6">
                            <h2 className="text-2xl font-bold mb-4 text-gray-800">Clases de Mañana ({tomorrowFormatted})</h2>
                            {classesTomorrow.length > 0 ? (
                                <ul className="space-y-4">
                                    {classesTomorrow.map(cls => (
                                        <li key={cls.id} className={`p-4 rounded-lg shadow-sm flex flex-col sm:flex-row justify-between items-start sm:items-center ${colorMap[cls.studentCount]}`}>
                                            <div>
                                                <p className="font-semibold text-gray-800 text-lg">{cls.time}</p>
                                                <p className="text-sm text-gray-600">{cls.studentNames.join(', ')}</p>
                                            </div>
                                            <div className="mt-2 sm:mt-0">
                                                <span className="font-bold text-gray-900">{formatPrice(cls.price)}</span>
                                            </div>
                                        </li>
                                    ))}
                                </ul>
                            ) : (
                                <p className="text-center text-gray-500 p-8 bg-white">No hay clases programadas para mañana.</p>
                            )}
                        </div>

                        <div className="bg-white p-6 rounded-xl shadow-lg">
                            <div className="flex justify-between items-center mb-6">
                                <h2 className="text-2xl font-bold text-gray-800">Clases Registradas</h2>
                                <div className="flex space-x-2">
                                    <button onClick={() => setView('add')} className="px-4 py-2 bg-blue-600 text-white rounded-lg font-bold shadow-md transition-colors hover:bg-blue-700">
                                        <i className="fas fa-plus mr-2"></i>Nueva Clase
                                    </button>
                                </div>
                            </div>
                            <div className="relative mb-4">
                                <i className="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                                <input
                                    type="text"
                                    placeholder="Filtrar por nombre de alumno..."
                                    value={filterText}
                                    onChange={(e) => setFilterText(e.target.value)}
                                    className="p-3 pl-12 w-full border rounded-lg focus:ring-2 focus:ring-blue-500 transition-shadow"
                                />
                            </div>
                            {filteredClasses.length > 0 ? (
                                <>
                                    <div className="overflow-x-auto">
                                        <table className="min-w-full divide-y divide-gray-200">
                                            <thead className="bg-gray-50">
                                                <tr>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fecha</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Día</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Hora</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Alumnos</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Precio</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
                                                </tr>
                                            </thead>
                                            <tbody className="bg-white divide-y divide-gray-200">
                                                {currentClasses.map((cls) => (
                                                    <tr key={cls.id}>
                                                        <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{cls.date.toDate().toLocaleDateString('es-AR')}</td>
                                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{cls.day}</td>
                                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{cls.time}</td>
                                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{cls.studentNames.join(', ')}</td>
                                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{formatPrice(cls.price)}</td>
                                                        <td className="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                            <button onClick={() => editClass(cls)} className="text-blue-600 hover:text-blue-900 mr-2">
                                                                <i className="fas fa-edit"></i>
                                                            </button>
                                                            <button onClick={() => deleteClass(cls.id)} className="text-red-600 hover:text-red-900">
                                                                <i className="fas fa-trash"></i>
                                                            </button>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                    <div className="mt-4 flex justify-between items-center">
                                        <div className="text-sm text-gray-700">Página {currentPage} de {totalPages}</div>
                                        <div className="flex space-x-2">
                                            <button
                                                onClick={() => paginate(currentPage - 1)}
                                                disabled={currentPage === 1}
                                                className="px-4 py-2 border rounded-lg text-sm font-medium bg-gray-200 hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed"
                                            >
                                                Anterior
                                            </button>
                                            <button
                                                onClick={() => paginate(currentPage + 1)}
                                                disabled={currentPage === totalPages}
                                                className="px-4 py-2 border rounded-lg text-sm font-medium bg-gray-200 hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed"
                                            >
                                                Siguiente
                                            </button>
                                        </div>
                                    </div>
                                </>
                            ) : (
                                <p className="text-center text-gray-500 p-8 bg-white">No hay clases registradas. ¡Comienza a agregar algunas!</p>
                            )}
                        </div>
                    </>
                );
        }
    };

    return (
        <div className="min-h-screen bg-gray-100 p-4 md:p-8">
            <header className="flex flex-col md:flex-row justify-between items-center mb-6 space-y-4 md:space-y-0">
                <h1 className="text-3xl font-extrabold text-gray-900">Gestión de Clases de Padel</h1>
                <div className="flex space-x-2">
                    <button onClick={() => setView('list')} className={`px-4 py-2 rounded-lg font-bold text-sm shadow-md transition-colors ${view === 'list' ? 'bg-blue-800 text-white' : 'bg-gray-200 text-gray-800'}`}>Clases</button>
                    <button onClick={() => setView('studentsList')} className={`px-4 py-2 rounded-lg font-bold text-sm shadow-md transition-colors ${view.startsWith('student') ? 'bg-blue-800 text-white' : 'bg-gray-200 text-gray-800'}`}>Alumnos</button>
                    <button onClick={() => setView('paymentsList')} className={`px-4 py-2 rounded-lg font-bold text-sm shadow-md transition-colors ${view.startsWith('payment') ? 'bg-blue-800 text-white' : 'bg-gray-200 text-gray-800'}`}>Pagos</button>
                    <button onClick={() => { generateMonthlyReports(); setView('reports'); }} className={`px-4 py-2 rounded-lg font-bold text-sm shadow-md transition-colors ${view === 'reports' ? 'bg-blue-800 text-white' : 'bg-gray-200 text-gray-800'}`}>Reportes</button>
                    <button onClick={() => { generateAnnualPaymentsReport(); setView('annualPaymentsReport'); }} className={`px-4 py-2 rounded-lg font-bold text-sm shadow-md transition-colors ${view === 'annualPaymentsReport' ? 'bg-blue-800 text-white' : 'bg-gray-200 text-gray-800'}`}>Reporte Anual</button>
                    <button onClick={() => setView('activityLog')} className={`px-4 py-2 rounded-lg font-bold text-sm shadow-md transition-colors ${view === 'activityLog' ? 'bg-blue-800 text-white' : 'bg-gray-200 text-gray-800'}`}>Actividad</button>
                    <button onClick={signOutUser} className="px-4 py-2 rounded-lg font-bold text-sm bg-red-600 text-white shadow-md transition-colors hover:bg-red-700">Salir</button>
                </div>
            </header>
            <main>
                {renderView()}
            </main>
            <div className="mt-8 text-center text-gray-500">
                ID de Usuario: <span className="font-mono">{userId}</span>
            </div>
            <MessageBox
                show={messageBox.show}
                title={messageBox.title}
                content={messageBox.content}
                type={messageBox.type}
                onConfirm={messageBox.onConfirm}
                onClose={messageBox.onClose}
            />
        </div>
    );
};
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>



